<!DOCTYPE html>
<!-- saved from url=(0063)https://www.codeproject.com/Articles/5362252/Multitouch-Support -->
<html lang="en" data-lt-installed="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<link rel="preconnect" href="https://www.google-analytics.com/">

	<link rel="preconnect" href="https://www.codeproject.com/">


	<link rel="preload" href="./Resources/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="./Resources/jquery-3.4.1.min.js.download" as="script" type="text/javascript">


	<title>Multitouch Support for Ten-Finger Playing- CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="./Resources/Article.min.css">


    <script type="text/javascript" async="" src="./Resources/analytics.js.download"></script><script type="text/javascript" src="./Resources/jquery-3.4.1.min.js.download" defer=""></script>
<script type="text/javascript" src="./Resources/article.min.js.download" defer=""></script>

	
<meta http-equiv="content-language" content="en-US">

<meta name="Description" content="Microtonal Fabric uses multitouch screen support for musical keyboards">
<meta name="Keywords" content="Javascript, CSS, HTML, SVG">
<meta name="Author" content="Sergey Alexandrovich Kryukov">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">



<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="6/6/2023 10:23:00 PM">
<meta property="article:modified_time" content="7/24/2023 2:42:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Sergey Alexandrovich Kryukov">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="13 min read">
<meta property="og:url" content="https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing">
<meta property="og:title" content="Multitouch Support for Ten-Finger Playing">
<meta property="og:description" content="Microtonal Fabric uses multitouch screen support for musical keyboards">


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing"
   },
  "name": "Multitouch Support for Ten-Finger Playing",
  "headline": "Multitouch Support for Ten-Finger Playing",
  "url": "https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing",
  "discussionUrl": "https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing#_comments",
  "isFamilyFriendly": "true",
  "image": "https://www.codeproject.com/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "Javascript,CSS,HTML,SVG",
  "commentCount": "0",
  "editor" : {
    "@type" : "Person",
    "name" : "Editor",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
  },
  "license": "http://www.opensource.org/licenses/mit-license.php",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "If a multitouch screen is available, the user can play music with Microtonal Fabric applications with ten fingers, play chords, glissando, and use other techniques in all combinations. Microtonal Fabric uses a unified approach to cover the handling of the musical on-screen keyboards and more. The present article offers an easy-to-use yet comprehensive API suitable not only to Microtonal Fabric but a wide class of applications.",
  "articleSection": "HTML",
  "author" : [{
      "@type" : "Person",
      "name" : "Sergey Alexandrovich Kryukov",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
    }],
  "datePublished": "2023-06-06",
  "dateCreated": "2023-06-06",
  "dateModified": "2023-07-24"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 5.00,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=web",
      "name" : "web"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=HTML",
      "name" : "HTML"
    }
  }]
}</script>

<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="./Resources/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '42a7d533-9829-4f88-8fc6-84dc936250c9'});
    </script>

<style type="text/css"></style>
    <style>
        table, td, th { border: solid thin black; border-collapse: collapse; font-size: 120%; font-weight: normal; }
        td, th  { text-align: center; vertical-align: middle; padding-left: 0.4em; padding-right: 0.4em; }
        th { background-color: lightGray; }
    </style>

</head>	

<body class="chrome chrome120" data-new-gr-c-s-check-loaded="14.1215.0" data-gr-ext-installed="">



<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="./Resources/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed narrow">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">65,938 articles</div>
	
	<div id="ctl00_MemberBar_ChangeNotice" class="flex-item align-left">CodeProject
	is changing. <a href="https://www.codeproject.com/info/Changes.aspx">Read more</a>.</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed narrow">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Resources/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"></div>
        </div>
    </div>

	
			
	

	<div id="A" class="container-content-wrap fixed narrow"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=web">web</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=HTML">HTML</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing?display=Print" class="tooltip" title="">
   <img src="./Resources/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    
            

			
			<div id="AT" class="article-container  fixed narrow" style="max-width:inherit;"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="https://www.codeproject.com/Articles/5362252/View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="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">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>
					    <a name="_articleTop" id="_articleTop"></a>

					    
						<div>
							<span id="ctl00_TagListHorz_TagWrp" class="tags horizontal">

	
	

	
	<span id="ctl00_TagListHorz_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Javascript" data-id="87">Javascript</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/CSS" data-id="90">CSS</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/HTML" data-id="104">HTML</a></div><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/SVG" data-id="1618">SVG</a></div></span> 

	
	
</span>


						</div>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">Multitouch Support for Ten-Finger Playing</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2291164" rel="author">Sergey Alexandrovich Kryukov</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_5362252">

	<meta itemprop="upvoteCount" content="1">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		

		
		<div class="nowrap tooltip">

			
			<div id="ctl00_RateArticle_ResultNoHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div></div></div>
			

			
			

			
            

			
                

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">5.00/5  (1 vote)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container" style="color:#666;font-size:smaller">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">6 Jun, 2023, last revision: 24 Jul 2023</span><a id="ctl00_LicenseLink" title="The MIT License" class="license flex-item-tight" href="http://www.opensource.org/licenses/mit-license.php">MIT</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">13 min read</span><span id="ctl00_HorizontalStats" class="stats flex-item-tight"><span class="stats"><span title="Views"><img src="./Resources/views32.png" style="width:16px"> 8.1K</span> &nbsp; <span title="Downloads"><img src="./Resources/download32.png" style="width:16px"> 65</span> &nbsp; </span></span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Microtonal Fabric uses multitouch screen support for musical keyboards</div><span id="ctl00_ThumbnailUrl" class="date" content="https://www.codeproject.com/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					<div id="ctl00_Abstract" class="abstract">If a multitouch screen is available, the user can play music with Microtonal Fabric applications with ten fingers, play chords, glissando, and use other techniques in all combinations. Microtonal Fabric uses a unified approach to cover the handling of the musical on-screen keyboards and more. The present article offers an easy-to-use yet comprehensive API suitable not only to Microtonal Fabric but a wide class of applications.</div>

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<!-- Article Starts -->

<ul class="download">
    <li><a href="https://www.github.com/SAKryukov/microtonal-fabric.git">Download or clone source code from GitHub</a></li>
    <!--<li><a href="https://www.codeproject.com/KB/Articles/5362252/Microtonal-Fabric.zip">Download Microtonal Fabric source code — 294.9 KB</a><a href="https://www.codeproject.com/KB/Articles/5362252/Microtonal-Fabric.zip"></a>-->
</li></ul>

<p id="image-title">
</p><p><img alt="2023-06-06.Multitouch-Support-for-Ten-Finger-Playing.main.webp" src="./Resources-articles/2023-06-06.Multitouch-Support-for-Ten-Finger-Playing.main.webp"/></p><p></p>
<h2>Contents</h2>
<p class="toc">
<a style="margin-left: 0" href="#heading-introduction">Introduction</a><br>
<a style="margin-left: 0" href="#heading-the-problem3a-keyboard-keys-are-not-like-buttons21">The Problem: Keyboard Keys are not Like Buttons!</a><br>
<a style="margin-left: 0" href="#heading-microtonal-fabric-applications-using-multitouch-control">Microtonal Fabric Applications Using Multitouch Control</a><br>
<a style="margin-left: 0" href="#heading-implementation">Implementation</a><br>
<a style="margin-left: 3em" href="#heading-multitouch">Multitouch</a><br>
<a style="margin-left: 3em" href="#heading-usage-examples">Usage Examples</a><br>
<a style="margin-left: 3em" href="#heading-abstract-keyboard">Abstract Keyboard</a><br>
<a style="margin-left: 3em" href="#heading-using-extra-data">Using Extra Data</a><br>
<a style="margin-left: 0" href="#heading-compatibility">Compatibility</a><br>
<a style="margin-left: 0" href="#heading-conclusions">Conclusions</a><br>
</p><h2 id="heading-introduction">Introduction</h2>
<p>This is the fourth article of the series dedicated to musical study with on-screen keyboards, including microtonal ones:</p>

<ol>
<li><em><u><a href="2017-08-16.Musical-Study-with-Isomorphic-Computer-Keyboard.html">Musical Study with Isomorphic Computer Keyboard</a></u></em></li>
<li><em><u><a href="2017-09-01.Microtonal-Music-Study-with-Chromatic-Lattice-Keyboard.html">Microtonal Music Study with Chromatic Lattice Keyboard</a></u></em></li>
<li><em><u><a href="2020-05-19.Sound-Builder-Web-Audio-Synthesizer.html">Sound Builder, Web Audio Synthesizer</a></u></em></li>
<li><em>The present article</em></li>
</ol>

<p>The last three articles are devoted to the project named <a href="https://github.com/SAKryukov/microtonal-fabric">Microtonal Fabric</a>, a  microtonal music platform based on <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">WebAudio API</a>. It is a framework for building universal or customized microtonal musical keyboard instruments, microtonal experiments and computing, music study, and teaching music lessons with possible remote options. The platform provides several applications executed in a Web browser using shared JavaScript components.</p><p>See also <a href="https://en.xen.wiki/w/Sergey_A_Kryukov">my page</a> at the microtonal community Web site <a href="https://en.xen.wiki/">Xenharmonic Wiki</a>. In addition to the Microtonal Fabric links, there are some useful links on different microtonal topics and personalities.</p><p>Most of the Microtonal Fabric applications allow the user to play music in a browser. If a multitouch screen is available, the user can play with ten fingers. The required features of the multitouch interface are not as trivial as they may seem at first glance. The present article explains the problem and the solution. It shows how the multitouch behavior is abstracted from the other part of the code, reused, and utilized by different types of on-screen keyboards.</p><p>In the approach discussed, the application of the present multitouch solution is not limited to musical keyboards. The <em>view model</em> of the keyboard looks like a collection of HTML or SVG elements with two states: “activated” (down) or “deactivated” (up). The states can be modified by the user or by software in many different ways. First, let’s consider the entire problem.</p><h2 id="heading-the-problem3a-keyboard-keys-are-not-like-buttons21">The Problem: Keyboard Keys are not Like Buttons!</h2>
<p>So, why does the multitouch control of the keyboard present some problems? Well, mostly because the inertia of thinking could lead us in the wrong direction.</p><p>The most usual approach is to take the set of keys of some keyboard and attach some event handler to each one. It looks natural, but it cannot work at all.</p><p>Let’s see what playing with all ten fingers requires. On a screen, we have three kinds of area: 1) the area of some keyboard key, 2) the area of a keyboard not occupied by a key, and 3) the area outside the keyboard. When one or more fingers touch the screen inside the area of some key (case #1), a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch">Touch object</a> is created. The low-level touch event is invoked, but a semantic-level keyboard event to be handled to invoke key activation should be invoked only if there are no more <code>Touch</code> objects in the area of the given key. Likewise, when a finger is removed from the screen, a semantic-level keyboard event should be invoked only if there are no other <code>Touch</code> objects in the area of the key.</p><p>But this is not enough. The key activation can also be changed if a finger just slides on the screen. When a sliding finger enters the area or leaves the area of some key, it can come from or move to any of the areas of types #1 to #3. Depending on the presence of other <code>Touch</code> objects in the area of the given key, it can also change the activation state of this key. Most typically, it happens when fingers slide across two or more keys. This technique is known as <em>glissando</em>. And this is something that cannot be implemented when  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a> are attached to each key separately.</p><p>Why? It’s easy to understand by comparison with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events">pointer events</a>. These events include the events <code>pointerleave</code> and <code>pointerout</code>. These events make perfect sense for a single pointer controlled by a mouse or a touchpad. However, there is nothing similar in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a>. The keyboard keys do not at all behave like UI buttons. Despite the apparent similarity, they are totally different.</p><p>The only way to implement all the combinations of the semantic-level multitouch events is to handle low-level <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a> to some element containing all the keys. In Microsoft Fabric code, this is the element representing the entire keyboard. Let’s see how it is implemented in the section <a href="#heading-implementation">Implementation</a> <a href="#heading-multitouch">Multitouch</a>.</p><p>Before looking at the implementation, the reader may want to look at the available Microtonal Fabric applications using multitouch control. For all the applications, <em>live play</em> is available. For each application, the live play URL can be found below.</p><h2 id="heading-microtonal-fabric-applications-using-multitouch-control">Microtonal Fabric Applications Using Multitouch Control</h2>

<table><tbody><tr><th>Application</th><th>Source code</th><th>Live play</th></tr><tr><td>Multi-EDO</td><td>./Multi-EDO</td><td><a href="https://sakryukov.github.io/microtonal-fabric/code/Multi-EDO">Multi-EDO</a></td></tr><tr><td>29-EDO</td><td>./29-EDO</td><td><a href="https://sakryukov.github.io/microtonal-fabric/code/29-EDO">29-EDO</a></td></tr><tr><td>Microtonal Playground</td><td>./playground</td><td>    <a href="https://sakryukov.github.io/microtonal-fabric/code/playground?user.data">Aura's Diatonic Scales</a><br>
    <a href="https://sakryukov.github.io/microtonal-fabric/code/playground?custom/12-EDO.user.data">Common-practice 12-EDO</a><br>
    <a href="https://sakryukov.github.io/microtonal-fabric/code/playground?custom/shruti.user.data">Shruti Scales</a><br>
    <a href="https://sakryukov.github.io/microtonal-fabric/code/playground?custom/chinese.user.data">Traditional Chinese Tonal System</a><br>
    <a href="https://sakryukov.github.io/microtonal-fabric/code/playground?custom/customized.user.data">Microtonal Playground Customization Demo</a><br>
</td></tr><tr><td><a href="https://en.xen.wiki/w/Color_notation#Interval_Names">Kite Giedraitis keyboard</a><br>(under development)</td><td>./Kite.Giedraitis</td><td><a href="https://sakryukov.github.io/microtonal-fabric/code/Kite.Giedraitis">Kite Giedraitis</a></td></tr></tbody></table>
<h2 id="heading-implementation">Implementation</h2>
<p>The idea is: we need a separate unit abstracted from the set of UI elements representing the keyboard. We are going to set some <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a> to the single HTML or SVG control representing the entire keyboard. These events should be interpreted by some events that may or may not be related to the keyboard keys. To pull the information on the keys from the user, we are going to use <em>inversion of control</em>.</p><p>The touch functionality is implemented by attaching the events to some element representing an entire keyboard using the single call to the function <code>setMultiTouch</code>, and it gets the key configuration information and invokes the semantic-level key events through three callback handers. Let’s see how it works.</p><h3 id="heading-multitouch">Multitouch</h3>
<p>The function <code>setMultiTouch</code> assumes the following UI model of the multitouch sensitive area: a <code>container</code> HTML or SVG element containing one or more HTML or SVG child elements, they can be direct or indirect children.</p><p>The function accepts four input arguments, <code>container</code>, and three handlers:</p><ul>
<li><code>container</code>: HTML or SVG handling multitouch events</li><li><code>elementSelector</code>: the handler to select relevant children in <code>container</code>.
<br>
Profile: <code>element =&gt; bool</code>
<br>If this handler returns <code>false</code>, the event is ignored. Essentially, this handler is used by the user code to define the HTML or SVG elements to be interpreted as keys of some keyboard represented by the <code>container</code>.</li><li><code>elementHandler</code>: the handler used to implement main keyboard functionality.
<br>Profile: <code>(element, Touch touchObject, bool on, touchEvent event) =&gt; undefined</code>
<br>The handler is used to implement the main functionality, for example, produce sounds in response to the keyboard events; the handler accepts <code>element</code>, a touch object, and a Boolean <code>on</code> argument showing if this is an “on” or “off” action. Basically, this handler calls a general semantic handler which can be triggered in different ways, for example, through a keyboard or a mouse. Essentially, it implements the action triggered when a keyboard key, represented by <code>element</code> is activated or deactivated, depending on the value of <code>on</code>.</li><li><code>sameElementHandler</code>: the handler used to handle events within the same element
<br>Profile: <code>(element, Touch touchObject) =&gt; undefined</code></li></ul>
<p id="code-multitouch">“ui.components/multitouch.js”:</p><div class="pre-lang" id="premain358736"><div>JavaScript</div><div class="pre-action-link"><span class="code-collapse" data-index="358736" id="preShrink358736">Shrink ▲</span> &nbsp; <span id="copycode358736" class="copy-code" data-index="358736" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre358736" style="margin-top:0;" class="lang-javascript notranslate" data-language="JavaScript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-string">"</span><span class="code-string">use strict"</span>;

<span class="code-keyword">const</span> setMultiTouch = (
    container,
    elementSelector,
    elementHandler,
    sameElementHandler,
) =&gt; {

    <span class="code-keyword">if</span> (!elementSelector)
        <span class="code-keyword">return</span>;
    <span class="code-keyword">if</span> (!container) container = <span class="code-sdkkeyword">document</span>;

    <span class="code-keyword">const</span> assignEvent = (element, name, handler) =&gt; {
        element.addEventListener(name, handler,
            { passive: <span class="code-keyword">false</span>, capture: <span class="code-keyword">true</span> });
    };
    <span class="code-keyword">const</span> assignTouchStart = (element, handler) =&gt; {
        assignEvent(element, <span class="code-string">"</span><span class="code-string">touchstart"</span>, handler);
    };
    <span class="code-keyword">const</span> assignTouchMove = (element, handler) =&gt; {
        assignEvent(element, <span class="code-string">"</span><span class="code-string">touchmove"</span>, handler);
    };
    <span class="code-keyword">const</span> assignTouchEnd = (element, handler) =&gt; {
        assignEvent(element, <span class="code-string">"</span><span class="code-string">touchend"</span>, handler);
    };

    <span class="code-keyword">const</span> isGoodElement = element =&gt; element &amp;&amp; elementSelector(element); 
    <span class="code-keyword">const</span> elementDictionary = {};
    
    <span class="code-keyword">const</span> addRemoveElement = (touch, element, doAdd, event) =&gt; {
        <span class="code-keyword">if</span> (isGoodElement(element) &amp;&amp; elementHandler)
            elementHandler(element, touch, doAdd, event);
        <span class="code-keyword">if</span> (doAdd)
            elementDictionary[touch.identifier] = element;
        <span class="code-keyword">else</span>
            <span class="code-keyword">delete</span> elementDictionary[touch.identifier];
    }; <span class="code-comment">//</span><span class="code-comment">addRemoveElement</span>

    assignTouchStart(container, ev =&gt; {
        ev.preventDefault();
        <span class="code-keyword">if</span> (ev.changedTouches.length &lt; <span class="code-digit">1</span>) <span class="code-keyword">return</span>;
        <span class="code-keyword">const</span> touch = ev.changedTouches[ev.changedTouches.length - <span class="code-digit">1</span>];
        <span class="code-keyword">const</span> element =
            <span class="code-sdkkeyword">document</span>.elementFromPoint(touch.clientX, touch.clientY);
        addRemoveElement(touch, element, <span class="code-keyword">true</span>, ev);    
    }); <span class="code-comment">//</span><span class="code-comment">assignTouchStart</span>
    
    assignTouchMove(container, ev =&gt; {
        ev.preventDefault();
        <span class="code-keyword">for</span> (<span class="code-keyword">let</span> touch of ev.touches) {
            <span class="code-keyword">let</span> element =
                <span class="code-sdkkeyword">document</span>.elementFromPoint(touch.clientX, touch.clientY);
            <span class="code-keyword">const</span> goodElement = isGoodElement(element); 
            <span class="code-keyword">const</span> touchElement = elementDictionary[touch.identifier];
            <span class="code-keyword">if</span> (goodElement &amp;&amp; touchElement) {
                <span class="code-keyword">if</span> (element == touchElement) {
                    <span class="code-keyword">if</span> (sameElementHandler)
                        sameElementHandler(element, touch, ev)
                        <span class="code-keyword">continue</span>;
                    } <span class="code-comment">//</span><span class="code-comment">if same</span>
                addRemoveElement(touch, touchElement, <span class="code-keyword">false</span>, ev);            
                addRemoveElement(touch, element, truem, ev);
            } <span class="code-keyword">else</span> {
                <span class="code-keyword">if</span> (goodElement)
                    addRemoveElement(touch, element, goodElement, ev);
                <span class="code-keyword">else</span>
                    addRemoveElement(touch, touchElement, goodElement, ev);
            } <span class="code-comment">//</span><span class="code-comment">if    </span>
        } <span class="code-comment">//</span><span class="code-comment">loop</span>
    }); <span class="code-comment">//</span><span class="code-comment">assignTouchMove</span>
    
    assignTouchEnd(container, ev =&gt; {
        ev.preventDefault();
        <span class="code-keyword">for</span> (<span class="code-keyword">let</span> touch of ev.changedTouches) {
            <span class="code-keyword">const</span> element =
                <span class="code-sdkkeyword">document</span>.elementFromPoint(touch.clientX, touch.clientY);
            addRemoveElement(touch, element, <span class="code-keyword">false</span>, ev);
        } <span class="code-comment">//</span><span class="code-comment">loop</span>
    }); <span class="code-comment">//</span><span class="code-comment">assignTouchEnd</span>

};</pre><p>The central point of the <code>setMultiTouch</code> implementation is the call to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/elementFromPoint">document.elementFromPoint</a>. This way, the elements related to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch">Touch event data</a> are found. When an element is found, it is checked up whether this is the element representing a keyboard key, and the function <code>isGoodElement</code> does that using the handler <code>elementSelector</code>. If it is, the handler <code>elementHandler</code> or <code>sameElementHandler</code> is called, depending on the event data. These calls are used to handle <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a> <code>"touchstart"</code>, <code>"touchmove"</code>, and <code>"touchend"</code>.</p><p>Let’s see how <code>setMultiTouch</code> can be used by applications.</p><h3 id="heading-usage-examples">Usage Examples</h3>
<p>A very typical usage example can be found in the application 29-EDO. It provides several keyboard layouts and two different tonal systems (29-EDO and a common-practice 12-EDO), but the keyboards reuse a lot of common code. For all the keyboard layouts <code>elementSelector</code> is based on the fact that all the keyboard keys are rectangular SVG elements <a href="https://developer.mozilla.org/en-US/docs/Web/API/SVGRectElement">SVGRectElement</a>, but the keyboards are not, they are represented by an SVG element, <a href="https://developer.mozilla.org/en-US/docs/Web/API/SVGSVGElement">SVGSVGElement</a>.</p><p>Also, the keyboards have a common semantic-level handler <code>handler(element, on)</code>, it controls highlighting and audio action of a key represented by <code>element</code>, depending on its Boolean activation state <code>on</code>. This is a common handler used via the touch API and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events">pointer API</a>. The handler can also be activated by the code through a computer keyboard or other control elements. In particular, it can be called by the Microtonal Fabric sequence <em>recorder</em>. It makes the call to <code>setMultiTouch</code> pretty simple:</p><p id="code-29-edo">“29-EDO/ui/keyboard.js”:</p><div class="pre-lang" id="premain185238"><div>JavaScript</div><div class="pre-action-link"><span id="copycode185238" class="copy-code" data-index="185238" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre185238" style="margin-top:0;" class="lang-javascript notranslate" data-language="JavaScript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true">setMultiTouch(
    element,
    element =&gt; element.<span class="code-sdkkeyword">constructor</span> == SVGRectElement,
    (element, _, on) =&gt; handler(element, on));</pre><p>Here, the first <code>element</code> represents a keyboard, an <a href="https://developer.mozilla.org/en-US/docs/Web/API/SVGRectElement">SVGRectElement</a>, and the <code>element</code> arguments of the handlers represent the keyboard keys.</p><p>In another place the expression <code>element.constructor == SVGCircleElement</code> is used, for the application having only round-shaped keys.</p><p>There is a more dedicated example where the selection of the key element is performed by a method of some abstract JavaScript class.</p><p id="code-abstract-keyboard">“ui.components/abstract-keyboard.js”:</p><div class="pre-lang" id="premain315308"><div>JavaScript</div><div class="pre-action-link"><span id="copycode315308" class="copy-code" data-index="315308" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre315308" style="margin-top:0;" class="lang-javascript notranslate" data-language="JavaScript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">class</span> AbstractKeyboard {
    <span class="code-comment">//</span><span class="code-comment">...</span>
    setMultiTouch(
        parentElement,
        keyElement =&gt; <span class="code-keyword">this</span>.isTouchKey(parentElement, keyElement),
        (keyElement, _, on) =&gt; handler(keyElement, on));
}</pre><p>This second example is more interesting from a programming standpoint. Let’s discuss it in more detail.</p><h3 id="heading-abstract-keyboard">Abstract Keyboard</h3>
<p>The <a href="#code-abstract-keyboard">last example</a> shows an additional abstraction layer: the universal piece of code setting up the multitouch features is placed once in a class representing an abstract keyboard. Potentially, more than one terminal keyboard class can be derived from <code>AbstractKeyboard</code> and reuse the multitouch setup and other common keyboard features.</p><p>In the class <code>AbstractKeyboard</code>, the functions used in the call to <code>setMultiTouch</code> are not fully defined: the function <code>this.isTouchKey</code> is not defined at all, and the function <code>handler</code> is defined, but it depends on not yet functions. These functions are supposed to be implemented in all the terminal classes derived from <code>AbstractKeyboard</code>. But how to guarantee it?</p><p>To guarantee, I’ve put forward a new technique I called <em>interface</em> (“agnostic/interfaces.js”). The keyboard classes do not extend an appropriate interface class, they just implement proper functions defined in a particular interface, a descendant class of the class <code>IInterface</code> (agnostic/interfaces.js"). The only purpose of <code>IInterface</code> is to provide a way of early detection of the problem due to the lack of full implementation of an interface to some degree of <em>strictness</em>. To understand the concept of strictness, please see <code>const IInterfaceStrictness</code> in the same file, it is self-explaining.</p><p>In the example of the application Microtonal Playground, the terminal keyboard class implements the multitouch behavior not directly by calling <code>setMultiTouch</code>, but by inheriting from <code>AbstractKeyboard</code> through the following inheritance diagram:</p><p><code>AbstractKeyboard</code> (“ui.components\abstract-keyboard.js”) ◁─ <code>GridKeyboard</code> (“ui.components\grid-keyboard.js”) ◁― <code>PlaygroungKeyboard</code> (“playground\ui\playground-keyboard.js”)</p><p>In addition to the inheritance from <code>AbstractKeyboard</code>, the terminal class is supposed to implement <code>IKeyboardGeometry</code>:</p><p><code>IInterface</code> (“agnostic/interfaces.js”) ◁— <code>IKeyboardGeonetry</code> (“ui.components\abstract-keyboard.js”)</p><p id="code-ikeyboardgeometry">“ui.components\abstract-keyboard.js”:</p><div class="pre-lang" id="premain134016"><div>JavaScript</div><div class="pre-action-link"><span id="copycode134016" class="copy-code" data-index="134016" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre134016" style="margin-top:0;" class="lang-javascript notranslate" data-language="JavaScript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">class</span> IKeyboardGeometry <span class="code-keyword">extends</span> IInterface {
    createKeys(parentElement) {}
    createCustomKeyData(keyElement, index) {}
    highlightKey(keyElement, keyboardMode) {}
    isTouchKey(parentElement, keyElement) {} <span class="code-comment">//</span><span class="code-comment"> for touch interface</span>
    get defaultChord() {} <span class="code-comment">//</span><span class="code-comment"> should return array of indices of keys in default chord</span>
    customKeyHandler(keyElement, keyData, on) {} <span class="code-comment">//</span><span class="code-comment"> return false to stop embedded handling</span>
}</pre><p>The implementation of this interface guarantees that the functions of <code>AbstractKeyboard</code> work correctly, and the fact that the implementation of <code>IKeyboardGeometry</code> is fully implemented is validated by the constructor of the class <code>AbstractKeyboard</code>.</p><p id="code-test-interface-implementation">This validation is throwing an exception in case the implementation of the interface is not satisfactory:</p><div class="pre-lang" id="premain807671"><div>JavaScript</div><div class="pre-action-link"><span id="copycode807671" class="copy-code" data-index="807671" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre807671" style="margin-top:0;" class="lang-javascript notranslate" data-language="JavaScript" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true"><span class="code-keyword">class</span> AbstractKeyboard {

    #implementation = { mode: <span class="code-digit">0</span>, chord: <span class="code-keyword">new</span> Set(), playingElements: <span class="code-keyword">new</span>(Set), chordRoot: -1, useHighlight: <span class="code-keyword">true</span> };
    derivedImplementation = {};
    derivedClassConstructorArguments = [<span class="code-keyword">undefined</span>];

    <span class="code-sdkkeyword">constructor</span>(parentElement, ...moreArguments) {
        IKeyboardGeometry.throwIfNotImplemented(<span class="code-keyword">this</span>);
        <span class="code-keyword">this</span>.derivedClassConstructorArguments = moreArguments;
        <span class="code-comment">//</span><span class="code-comment">...</span>
    }

    <span class="code-comment">//</span><span class="code-comment">...</span>

}</pre><p>For the detail of <code>IInterface.throwIfNotImplemented</code> please see the source code, “agnostic/interfaces.js”. The validation of the interface implementation is based on the reflection of the terminal class performed during runtime by the constructor. It checks up all the interface functions, property getters, and setters, and, depending on required strictness, the number of arguments for each function. In our case, it happens during the construction of the terminal application-level class <code>PlaygroungKeyboard</code> of the application Microtonal Playground. The application itself deserves a separate article.</p><p>Apparently, this is just the imitation of the interface mechanism found in some well-designed compiled languages. It validates the implementation of the interfaces later, during runtime, but as soon as possible. Naturally, the mechanism cannot change the behavior of the software, it only facilitates debugging and, hence, software development. The mechanism does work, but I consider it experimental and do understand that its value is discussible. I would be grateful for any criticism or suggestions.</p><h3 id="heading-using-extra-data">Using Extra Data</h3>
<p>Note that none of the examples uses the second argument parameter of the handler <code>handler</code>, accepted as the second <code>setMultiTouch</code> argument, the argument <code>touchObject</code> of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch">Touch</a> type. And the last handlers’ argument <code>event</code> of the type<a href="https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent">TouchEvent</a> is not used. Also, the last argument of <code>setMultiTouch</code>, the handler <code>sameElementHandler</code> is not used. However, these arguments are fully functional and can be used. They are reserved for advanced use.</p><p>The <code>Touch</code> argument passed to <code>handler</code> is used to get additional information on the original touch event. In particular, I’ve tried to use the values <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch/radiusX">Touch.radiusX</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch/radiusY">Touch.radiusY</a>. My idea was to evaluate the area of the contact of the touchscreen with a finger. This information could be used to derive an amount of pressure, and hence, adjust sound volume based on this value, to add some dynamics to the performance. However, my experiments demonstrated that the performer poorly controls this value, and it is not the same as actual pressure. The more principle problem of those <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch">Touch</a> member properties is that their change does not trigger any touch events; an event is triggered only when the centroid of the touch is changed. Nevertheless, it is obvious that the <code>Touch</code> data can be useful for the implementation of some advanced effects.</p><p>The <code>event</code> argument of the handler is used for the implementation of plucked string instruments. The major purpose of this artument is to find out which finder defines the sound frequency in case more than one finger presses the same string against a fretboard. The instrument application used to mimic a plucked string instruments is presently under development.</p><p>The argument <code>sameElementHandler</code> of the function <code>setMultiTouch</code> is called when a touch event is triggered when a location of the touch remains within the same <code>element</code> as a previous touch event. Apparently, such events should not modify the activation state of the <code>element</code>. At the same time, such events can be used for the implementation of finer techniques. For example, the motion of a finger within the same key can be interpreted as finger-controlled <em>vibrato</em>.</p><p>All the finer techniques mentioned above are a matter of further research.</p><h2 id="heading-compatibility">Compatibility</h2>
<p>Microtonal Fabric functionality is based on advanced and modern JavaScipt and browser features and may fail when used with some Web browsers. Basically, it works correctly with all <a href="https://en.wikipedia.org/wiki/Chromium_(web_browser)">Chromium</a>-based browsers, or, more exactly, the modern browsers based on <a href="https://en.wikipedia.org/wiki/Blink_(browser_engine)">Blink</a> and <a href="https://en.wikipedia.org/wiki/V8_(JavaScript_engine)">V8</a> engines. It means <a href="https://en.wikipedia.org/wiki/Chromium_(web_browser)">Chromium</a>, <a href="https://en.wikipedia.org/wiki/Google_Chrome">Chrome</a>, and some other derived browsers. Even the latest “Anaheim” <a href="https://en.wikipedia.org/wiki/Microsoft_Edge#New_Edge_(2019%E2%80%93present)">Microsoft Edge</a> works correctly.</p><p>Unfortunately, the present-day <a href="https://en.wikipedia.org/wiki/Firefox">Mozilla browsers</a> manifest some problems and cannot correctly run the Microtonal Fabric application. In particular, <a href="https://en.wikipedia.org/wiki/Firefox">Firefox</a> for Linux does not properly handle the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Touch_events">touch events</a> described in the present article. Microtonal Fabric users and I keep an eye on compatibility, so I’ll try to update compatibility information if something changes.</p><h2 id="heading-conclusions">Conclusions</h2>
<p>We have a mechanism and an abstraction layer to be used as a semantic wrapper around a more general touch API, which is closer to the touchscreen hardware. This layer presents the events in а form adequate to the <em>view model</em> of an on-screen keyboard or other UI elements similar in functionality. The code using this layer calls a single function <code>setMultiTouch</code> and passes its semantic handlers.</p><p>Optionally, on top of this layer, the user can use a more specific and potentially less universal API based on <code>IKeyboardGeometry</code> and JavaScript classes.</p><p>These two options present a comprehensive semantic-level mechanism for the implementation of all aspects of the behavior of on-screen keyboards based on a multitouch touchscreen. At the same time, it leaves the UI open to other input methods, such as a physical computer keyboard, mouse, or touchpad.</p>




						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.opensource.org/licenses/mit-license.php" rel="license">The MIT License</a></p></div>
						

						
						<br>
						
						    <br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    
				</div>
				
                
                

				
				
				

			</div>
			

            
            
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/5362252/Multitouch-Support-for-Ten-Finger-Playing">Permalink</a><br>
				<br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/5362252/Multitouch-Support?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/5362252/Multitouch-Support?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2023 by Sergey Alexandrovich Kryukov<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2024<br>
                <br>
				Web01 
				2.8:2024-12-08:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>







<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>s