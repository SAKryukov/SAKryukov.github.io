<!DOCTYPE html>
<!-- saved from url=(0072)https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio -->
<html lang="en" data-lt-installed="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	
	<link rel="preconnect" href="https://www.google-analytics.com/">

	<link rel="preconnect" href="https://www.codeproject.com/">


	<link rel="preload" href="./Resources/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="./Resources/jquery-3.4.1.min.js.download" as="script" type="text/javascript">


	<title>Video Screen Capture with Audio- CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="./Resources/Article.min.css">


    <script type="text/javascript" async="" src="./Resources/analytics.js.download"></script><script type="text/javascript" src="./Resources/jquery-3.4.1.min.js.download" defer=""></script>
<script type="text/javascript" src="./Resources/article.min.js.download" defer=""></script>

	
<meta http-equiv="content-language" content="en-US">

<meta name="Description" content="Most flexible and comprehensive yet very simple FFMpeg-based command captures all screen activity in a video file, optionally with audio">
<meta name="Keywords" content="Windows, Beginner, Intermediate, Advanced">
<meta name="Author" content="Sergey Alexandrovich Kryukov">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">



<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="1/4/2021 5:42:00 PM">
<meta property="article:modified_time" content="1/4/2021 5:42:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Sergey Alexandrovich Kryukov">
<meta name="twitter:label2" content="Reading time">
<meta name="twitter:data2" content="3 min read">
<meta property="og:url" content="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio">
<meta property="og:title" content="Video Screen Capture with Audio">
<meta property="og:description" content="Most flexible and comprehensive yet very simple FFMpeg-based command captures all screen activity in a video file, optionally with audio">


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio"
   },
  "name": "Video Screen Capture with Audio",
  "headline": "Video Screen Capture with Audio",
  "url": "https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio",
  "discussionUrl": "https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#_comments",
  "isFamilyFriendly": "true",
  "image": "https://www.codeproject.com/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "Windows,Beginner,Intermediate,Advanced",
  "commentCount": "0",
  "editor" : {
    "@type" : "Person",
    "name" : "Editor",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "FFMpeg does it all. However, the combination of video and audio capture raises some delicate problems. The present article explains all the options and considerations for Windows",
  "articleSection": "Windows",
  "author" : [{
      "@type" : "Person",
      "name" : "Sergey Alexandrovich Kryukov",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
    }],
  "datePublished": "2021-01-04",
  "dateCreated": "2021-01-04",
  "dateModified": "2021-01-04"
,
  "contentRating" : {
    "@type" : "Rating",
    "ratingValue" : 5.00,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=operating-systems",
      "name" : "operating-systems"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/script/Content/Tag.aspx?tags=Windows",
      "name" : "Windows"
    }
  }]
}</script>


	<!--<base target="_top">--><base href="." target="_top">
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="./Resources/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '42a7d533-9829-4f88-8fc6-84dc936250c9'});
    </script>

<style type="text/css"></style></head>	

<body class="chrome chrome120" data-new-gr-c-s-check-loaded="14.1215.0" data-gr-ext-installed="">



<a class="access-link" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#Main"><img alt="Click here to Skip to main content" src="./Resources/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed narrow">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">65,938 articles</div>
	
	<div id="ctl00_MemberBar_ChangeNotice" class="flex-item align-left">CodeProject
	is changing. <a href="https://www.codeproject.com/info/Changes.aspx">Read more</a>.</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed narrow">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Resources/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"></div>
        </div>
    </div>

	
			
	

	<div id="A" class="container-content-wrap fixed narrow"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=operating-systems">operating-systems</a> / <a rel="nofollow" href="https://www.codeproject.com/script/Content/Tag.aspx?tags=Windows">Windows</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio?display=Print" class="tooltip" title="">
   <img src="./Resources/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    
            

			
			<div id="AT" class="article-container  fixed narrow" style="max-width:inherit;"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="https://www.codeproject.com/Tips/5291304/View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="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">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>
					    <a name="_articleTop" id="_articleTop"></a>

					    
						<div>
							<span id="ctl00_TagListHorz_TagWrp" class="tags horizontal">

	
	

	
	<span id="ctl00_TagListHorz_VisibleTags"><div class="t"><a rel="tag" href="https://www.codeproject.com/Tags/Windows" data-id="94">Windows</a></div></span> 

	
	
</span>


						</div>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">Video Screen Capture with Audio</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2291164" rel="author">Sergey Alexandrovich Kryukov</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_5291304">

	<meta itemprop="upvoteCount" content="3">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		

		
		<div class="nowrap tooltip">

			
			<div id="ctl00_RateArticle_ResultNoHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-fill-lg.png" style="width:24px;height:24px"></div></div></div>
			

			
			

			
            

			
                

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">5.00/5  (3 votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container" style="color:#666;font-size:smaller">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">4 Jan 2021</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><span id="ctl00_ReadingTime" class="stats flex-item-tight">3 min read</span><span id="ctl00_HorizontalStats" class="stats flex-item-tight"><span class="stats"><span title="Views"><img src="./Resources/views32.png" style="width:16px"> 16.7K</span> &nbsp; <span title="Downloads"><img src="./Resources/download32.png" style="width:16px"> 510</span> &nbsp; </span></span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Most flexible and comprehensive yet very simple FFMpeg-based command captures all screen activity in a video file, optionally with audio</div><span id="ctl00_ThumbnailUrl" class="date" content="https://www.codeproject.com/script/Articles/Images/tip100x80.png"></span>			

                    </div>
                    
					
					

					

					
					<div id="ctl00_Abstract" class="abstract">FFMpeg does it all. However, the combination of video and audio capture raises some delicate problems. The present article explains all the options and considerations for Windows</div>

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<!-- Article Starts -->

<ul class="download">
	<li><a href="Video-Screen-Capture-with-Audio.Tip.zip">Download script with instructions — 720 bytes</a></li></ul>

<h2>Contents</h2>

<p class="toc"><a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-motivation" style="margin-left: 0">Motivation</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-insights" style="margin-left: 0">Insights</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-video" style="margin-left: 0">Video</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-audio" style="margin-left: 0">Audio</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-synchronization-between-audio-and-video" style="margin-left: 0">Synchronization between Audio and Video</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#heading-batch-file" style="margin-left: 0">Batch File</a><br>
<a href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio#LicenseTerms" style="margin-left: 0">License</a></p>

<h2 id="heading-motivation">Motivation</h2>

<p>Capturing video from a camera is commonplace. I wanted to capture video from the computer screen, for example, to produce a video lecture. I’ve noticed several CodeProject articles describing different means of capturing everything which happens on the computer screen. I did not found what I wanted. Some solutions are bound to some obsolete video containers or obsolete components, others are over-complicated or don’t work properly.</p>

<p>At the same time, the solution is way simpler and is readily available: compact, open-source, and built for most platforms <a href="https://ffmpeg.org/ffmpeg.html">FFMpeg</a> does it all.</p>

<h2 id="heading-insights">Insights</h2>

<p>Basically, everything is done using FFMpeg with this command line:</p>

<div class="pre-lang" id="premain973924"><div></div><div class="pre-action-link"><span id="copycode973924" class="copy-code" data-index="973924" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre973924" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ffmpeg
    -f dshow -i audio=<span class="code-string">"</span><span class="code-string">Stereo Mix (Realtek Audio)"</span> ^
    -f gdigrab -itsoffset <span class="code-digit">00</span>:<span class="code-digit">00</span>:<span class="code-digit">0</span>.<span class="code-digit">6</span> -i desktop -c:v libx264rgb ^
        -framerate <span class="code-digit">24</span> -crf <span class="code-digit">20</span> -preset ultrafast ^
    output-file.mp4</pre>

<p>Two <code>f</code> “enforce format” options define the methods of capturing video. Unfortunately, these methods and corresponding <code>-i</code> “input” options are platform-dependent. So far, I’ve sorted out the usage only for Windows, but later may need to do the same with Linux.</p>

<p>The first line after <code>ffmpeg</code> is optional and defines audio capture, two following lines — video capture. The audio capture depends on the device to be used. Sometimes, this is the audio produced by computer software, and this is the case shown in the command line above. In other cases, we need the capture from a microphone.</p>

<h2 id="heading-video">Video</h2>

<p>First of all, why using <a href="https://en.wikipedia.org/wiki/Advanced_Video_Coding">H264 (AVC) standard</a>? The answer is: for the same reason as <code>ultrafast</code>: performance. Usually, we don’t need the best compression, we need the algorithm which gives us good quality but not overwhelms the CPU and other resources. If encoding is slow, it won’t encode frames in time, and it can even delay the computer operation. In this situation, AVC is a very good choice. If you have a better idea, you can always replace the codec (<code>-c:v</code>) parameter and codec options (next line) with something else.</p>

<p>Naturally, for final production, the resulting video will require transcoding using some more advanced codec with good quality and much better compression. At the time of writing, I strongly recommend the most advanced <a href="https://en.wikipedia.org/wiki/Alliance_for_Open_Media">AOMedia</a> <a href="https://en.wikipedia.org/wiki/AV1">AV1</a>, but it can be something else. Please see FFMpeg documentation.</p>

<p>Video capture parameters:</p>

<p>Constant Rate Factor <code>crf</code>: valid values: 0-51, 0 is lossless, 23: default, 51: worse possible quality.</p>

<p>Frame rate <code>framerate</code>; common frame rates: 24, 25, 30, 48, 50, and 60</p>

<p>Presets: <code>ultrafast</code>, <code>superfast</code>, <code>veryfast</code>, <code>faster</code>, <code>fast</code>, <code>medium</code> (default), <code>slow</code>, <code>veryslow</code>; for the specific purpose of capture, we need the operation to be fast enough, caring of the compression factor much less. Perfectly compressed video with the best quality can be achieved after transcoding for production.</p>

<h2 id="heading-audio">Audio</h2>

<p>Audio capture is more sophisticated, as everything depends on system settings and the desired effect of capturing. On my very typical system, I have two recording devices “Microphone (Realtek Audio)” and “Stereo Mix (Realtek Audio)”. To obtain the list of available and enabled devices, use</p>

<div class="pre-lang" id="premain590389"><div></div><div class="pre-action-link"><span id="copycode590389" class="copy-code" data-index="590389" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre590389" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">ffmpeg -list_devices <span class="code-keyword">true</span> -f dshow -i dummy</pre>

<p>The use of a microphone is obvious, and “Stereo Mix” can be used to capture sounds produced by software.</p>

<p>The required device should be enabled in system settings: legacy control panel =&gt; Sound =&gt; (“Change sound card settings” =&gt; Recording) or (“Manage Audio Devices”).</p>

<h2 id="heading-synchronization-between-audio-and-video">Synchronization between Audio and Video</h2>

<p>It was the first problem I noticed: the delay between video and audio. The parameter <code>itsoffset</code> solves this problem. In the command line sample shown above, it fixes the delay of audio relative to video by delaying video.</p>

<p>If this parameter is placed in the audio line, it will delay audio relative to video.</p>

<h2 id="heading-batch-file">Batch File</h2>

<div class="pre-lang" id="premain267431"><div></div><div class="pre-action-link"><span id="copycode267431" class="copy-code" data-index="267431" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve"><g><path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272     c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729 c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path><path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272 c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001 C291.206,428.715,289.92,430,288.341,430z"></path></g></svg></span></div></div>
<pre id="pre267431" style="margin-top:0;" data-allowshrink="True" data-collapse="False" data-codeblock-processed="true" class="notranslate">@echo off
<span class="code-keyword">set</span> tool=c:/app/Media/ffmpeg/bin/ffmpeg.exe

<span class="code-keyword">set</span> videodelay=<span class="code-digit">00</span>:<span class="code-digit">00</span>:<span class="code-digit">0</span>.<span class="code-digit">6</span>
<span class="code-keyword">set</span> framerate=<span class="code-digit">24</span>
<span class="code-keyword">set</span> quality=<span class="code-digit">20</span>
<span class="code-keyword">set</span> microphone=<span class="code-string">"</span><span class="code-string">Microphone (Realtek Audio)"</span>
<span class="code-keyword">set</span> mix=<span class="code-string">"</span><span class="code-string">Stereo Mix (Realtek Audio)"</span>
<span class="code-keyword">set</span> audioChoice=%mix%

<span class="code-keyword">set</span> outputFile=%1
:request-file
<span class="code-keyword">if</span> <span class="code-string">"</span><span class="code-string">%outputFile%"</span>==<span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">set</span> /p outputFile=Output file name: 
<span class="code-keyword">if</span> <span class="code-string">"</span><span class="code-string">%outputFile%"</span>==<span class="code-string">"</span><span class="code-string">"</span> <span class="code-keyword">goto</span>:request-file

%tool% ^
    -f dshow -i audio=%audioChoice% ^
    -f gdigrab -itsoffset %videodelay% -i desktop -c:v libx264rgb ^
        -framerate %framerate% -crf %quality% -preset ultrafast ^
    %outputFile%.mp4</pre>

<p>The file name is requested by the script or entered as a command-line parameter, other parameters are rarely changed, can be adjusted manually.</p>

<p>The user will need to edit the path to “ffmpeg.exe” or setup the <code>PATH</code> environment variable accordingly.</p>

<!-- Article Ends -->


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

						
						<br>
						
						    <br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    
				</div>
				
                
                

				
				
				

			</div>
			

            
            
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio">Permalink</a><br>
				<br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Tips/5291304/Video-Screen-Capture-with-Audio?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2021 by Sergey Alexandrovich Kryukov<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2024<br>
                <br>
				Web01 
				2.8:2024-12-08:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>







<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>