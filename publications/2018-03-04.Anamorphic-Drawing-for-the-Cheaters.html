<!DOCTYPE html>
<!-- saved from url=(0080)https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters -->
<html lang="en" data-lt-installed="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	
	<link rel="preconnect" href="https://www.google-analytics.com/">

	<link rel="preconnect" href="https://www.codeproject.com/">


	<link rel="preload" href="./Resources/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="./Resources/jquery-3.4.1.min.js.download" as="script" type="text/javascript">


	<title>Anamorphic Drawing for the Cheaters- CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="./Resources/Article.min.css">


    <script type="text/javascript" async="" src="./Resources/analytics.js.download"></script><script type="text/javascript" src="./Resources/jquery-3.4.1.min.js.download" defer=""></script>
<script type="text/javascript" src="./Resources/article.min.js.download" defer=""></script>

	
<meta http-equiv="content-language" content="en-US">

<meta name="Description" content="Impress your friends with your drawing skills using this easy-to-use method and software">
<meta name="Keywords" content="">
<meta name="Author" content="Sergey Alexandrovich Kryukov">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">



<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="3/4/2019 11:20:00 AM">
<meta property="article:modified_time" content="3/8/2019 11:26:00 AM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Sergey Alexandrovich Kryukov">
<meta property="og:url" content="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters">
<meta property="og:title" content="Anamorphic Drawing for the Cheaters">
<meta property="og:description" content="Impress your friends with your drawing skills using this easy-to-use method and software">


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters"
   },
  "name": "Anamorphic Drawing for the Cheaters",
  "headline": "Anamorphic Drawing for the Cheaters",
  "url": "https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters",
  "discussionUrl": "#_comments",
  "isFamilyFriendly": "true",
  "image": "https://www.codeproject.com/App_Themes/CodeProject/Img/Article100.png",
  "commentCount": "0",
  "editor" : {
    "@type" : "Person",
    "name" : "Editor",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
  },
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "Impress your friends with your drawing skills using this easy-to-use method and software",
  "author" : [{
      "@type" : "Person",
      "name" : "Sergey Alexandrovich Kryukov",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
    }],
  "datePublished": "2019-03-04",
  "dateCreated": "2019-03-04",
  "dateModified": "2019-03-08"
}</script>

<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="./Resources/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '42a7d533-9829-4f88-8fc6-84dc936250c9'});
    </script>

<style type="text/css"></style></head>	

<body class="chrome chrome120" data-new-gr-c-s-check-loaded="14.1215.0" data-gr-ext-installed="">



<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="./Resources/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed narrow">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">65,938 articles</div>
	
	<div id="ctl00_MemberBar_ChangeNotice" class="flex-item align-left">CodeProject
	is changing. <a href="https://www.codeproject.com/info/Changes.aspx">Read more</a>.</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed narrow">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Resources/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"></div>
        </div>
    </div>

	
			
	

	<div id="A" class="container-content-wrap fixed narrow"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters?display=Print" class="tooltip" title="">
   <img src="./Resources/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    
            

			
			<div id="AT" class="article-container  fixed narrow" style="max-width:inherit;"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="https://www.codeproject.com/Articles/1278552/View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="CamDYAXsk4jsEc8vejbzFu1QM3GfwBFePzOIk0O5p4TDNWg3wbkAbDy/8EThm9QSTPKjPSU1Nmdplg5rUwD3NTYmKlVKZdLOE6hAot47lKFtWSsWtl3HIMwucwOjT1JvCvC9xTGWnSXjvqUyX9BllvSV392VC/Ic99+1Qox2zfdLkXGA9OFhHJ1eWcppHt0v5IPcfnSn3paFFytTrOF+Wj78xfuSasvIyG0SslA9ed+0kQs2Pui7UDu/Yq78+j7oCYWFIctAr71YuMcwKQWanQbyT5XDdxgHSUyRYXX7Om2zpofwbrreVgJvSCbNsGp2vKE0+UjpE1QuVIYrs7jYeXdh6OuHsIgD83HhT7IrFLwqv6FrgQu5GXJP8WOqXbJe0SGTWJujfoHXxMV3cgG9HJJDSdIsK4GlWlAi3+qhsNxGgrhDWf1J5z5iVjnMLtsmTZ8HKi2oMzwU0CHqEQfJ1O7H/OE0nlrGXKnGOgO0B4sdqZpQ90TLk+3i74dcZW5A2qkLgasDE0cJRknQZybygNwWIbI7RdZxATY3vY3Il/FffIzPt2DphcF9i6LjwmeaqmWI3YFIJvjJjXSaVpeKOgJERUE0SyqRvj7y0WJfJiUhJK1mHyv68LetG6Ciigrb+nvivzt6Xz9AA3yQ19XFBvNjBhWhBokd6vxBYAZXq9zuvIdp6sP9EldUu3k3oqCmZPp9ou6pp62ZST7kZt2bhg5fm7kUtguvU3XNT4qCA+KmtNXoJytqDhCSXy8EfbAef+OnQAn43d8s1cZNFYP9eSU9Nb3e/5e0aKkr24COMdJApn2N6yR6sVm6oygYEN3V/rtN52VUlqpRIqQSxOyNpQa+DfdTdO496qktNtHuCv6ZaGHGEUpoPrvzGN3Ixw2TmQk4EEZRxtX36AhOkfBCD6VRmB2oaOY9e5GKRCtzrvoa8BErXrHUtSeJTIfYe9kIrOFG7vsRqW8kn0glfvPzUQO8t2XnO8Lf1CYaGTJ7B9I+poP5J67D39OLsUxqOeSHYK/IacgJa+BuGjcx0USDW81+VOHAyj+hmg6qvuaChD2yqfyP+ZLAfjIzETs4v/odlmkHFZnOZ8pq78yFLXR3psp8mPv+C7Hd5cwS92JcZYUUP39I4+bVpWuRJRC6Uu3PU56SqkPdj86ZfyfqqY1WI2f3rT4WZvTwtXbPBZExMo1K2d7Lgl2hI1shgXoxpF1LVWyRGWZ4PBiRbznF8f3sssUiitvc75p7q88vsH483MnrKhyDuegG2Ckx5UjABwa97qvGujF4Too/akIcnjtoHtoogSC8C3dC3qF436jNUlF0Lenxb9KUNRxavT0WtDvh9a9pjiHCTzs9LYda/0D0/qDgyF9HW3nTmGcq1cdf3NtNHZYylQAVTEFKB/MSYe7bjOMWGMSAn+kmKj5mQYU8zS0gKRdrrmdTjwnd2txlm4e9+DoOXM2Y/Nkr22wt+4ACJu/SWzIBl0g5SMfAkDH+xGerRKj5WiOeJr/pYkf9y3HCGrDrg2O4IyejcLcsClslaC1jd8kpQPZfEDTuMkhdy6R6TijQdSVBx8Z/EsYiXft8piz2OhdKOGV6l4q9+Q+H+g/AqvhE4Cfh3rrIY2s4WNYcn3e5QMAUZvyKa3L3XCsikLBoQiyDNCNQaIV54s9PsJ+5/jz4Hs53QYX1fz8rMCoDm9FJA9Xh5ftuYKiGy7Go2DcSK5OSZTy4oh7mJGS5VTH65dfzvczjvi7Vi/E2l6r/TgqHc/scRaBzgLor2hqoCDBu">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>
					    <a name="_articleTop" id="_articleTop"></a>

					    
						<div>
							<span id="ctl00_TagListHorz_TagWrp">

	
	

	
	<span id="ctl00_TagListHorz_VisibleTags" class="subdue">(untagged)</span> 

	
	
</span>


						</div>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">Anamorphic Drawing for the Cheaters</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2291164" rel="author">Sergey Alexandrovich Kryukov</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_1278552">

	<meta itemprop="upvoteCount" content="0">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		

		
		<div class="nowrap tooltip">

			
			<div id="ctl00_RateArticle_ResultNoHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div style="width:24px;position:relative" class="clipped"><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div></div></div>
			

			
			

			
            

			
                

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">0.00/5  (No votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container" style="color:#666;font-size:smaller">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">4 Mar 2018, last revision: 8 Mar 2019</span><span id="ctl00_HorizontalStats" class="stats flex-item-tight"><span class="stats"><span title="Views"><img src="./Resources/views32.png" style="width:16px"> 1</span> &nbsp; </span></span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Impress your friends with your drawing skills using this easy-to-use method and software</div><span id="ctl00_ThumbnailUrl" class="date" content="https://www.codeproject.com/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<!-- Article Starts -->

<ul class="download">
    <li><a href="">Download or clone source code from GitHub</a></li></ul>

	<li><a href="Anamorphic-Drawing-for-the-Cheaters.zip">Download source code — 530.4 KB</a></li></ul>

<p id="drawing.top">&nbsp;</p>

<p><img alt="Anamorphic Drawing" src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.drawing.jpg"></p>

<p>&nbsp;</p>

<blockquote class="FQ" id="epigraph">
<div class="FQA">Epigraph:</div>

<p><i>Painting is an illusion, a piece of magic, so what you see is <a href="https://en.wikipedia.org/wiki/WYSIWYG">not</a> what you see.</i></p>

<dl>
	<dd><a href="https://en.wikipedia.org/wiki/Philip_Guston">Philip Guston</a></dd></dl>
</blockquote>

<h2 id="heading.contents">Contents</h2>

<div class="toc">
<ul style="list-style-type: none; margin-top: 0; margin-bottom: 0">
	<li><a href="#heading.anamorphic-drawing">Anamorphic Drawing</a></li>	<li><a href="#heading.insight">Insight</a></li>	<li><a href="#heading.how-to-create-the-illusion3f">How to Create the Illusion?</a></li>	<li><a href="#heading.workflow">Workflow</a></li>	<li><a href="#heading.implementation">Implementation</a>
	<ul style="list-style-type: none; margin-top: 0; margin-bottom: 0">
		<li><a href="#heading.perspective-transform">Perspective Transform</a></li>		<li><a href="#heading.geometry">Geometry</a></li>		<li><a href="#heading.user-interface">User Interface</a></li>		<li><a href="#heading.user-interface-design3a-collaboration-and-grip-couplers">User Interface Design: Collaboration and Grip Couplers</a></li>		<li><a href="#heading.build-and-compatibility">Build and Compatibility</a></li>	</ul>
	</li></ul>
</div>

<h2 id="heading.anamorphic-drawing">Anamorphic Drawing</h2>
<p>What is shown in the <a href="#drawing.top">picture above</a>? No, this is not a toy colt standing on a piece of paper. And this is not a photograph of a toy colt.</p>
<p>The pen reveals it: it lies flat on a piece of paper which in turn lies flat on the desk; at the same time, the colt is showing in its background. It looks impossible.</p>
<p>In fact, only two objects are placed on the glass top of the desk: a flat piece of paper and a pen lying flat on top of it. The picture is a photograph showing this desk and these two object on top. On this piece of paper, there is a <em>drawing</em> of a colt; the paper is cut by the contour of the image of the toy colt. The photograph is taken from the special <em>vantage point</em> creating the illusion of the vertical position of the colt. It looks like it “sticks out” of the plane of the drawing. Naturally, the drawing is distorted in a special way, to support the illusion.</p>
<p>This is one kind of <em><a href="https://en.wikipedia.org/wiki/Anamorphic_art">anamorphic art</a></em>; there are many interesting <a href="https://www.youtube.com/results?search_query=anamorphic+drawing">examples of it on youtube</a>.</p>
<p>Of course, anyone can get trained and learn drawing of such images. However, this is not so easy and is considerably more difficult than drawing in a traditional way. What if I show a very simple and convenient way to cheat here, so even a person with rudimentary drawing skills could create such a miracle?</p>
<p id="drawing.about">How? Using this application:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.about.webp" alt="About"></p>
<h2 id="heading.insight">Insight</h2>
<p>The idea is fairly simple. Let’s assume we place a rectangular piece of paper on a desk and photograph it so it would be pictured as a <em>symmetric</em> trapezoidal shape, due to perspective effect. Put or suspend some object on top of it. Imagine that later a picture will be put in the same place. It could be an image of the same object and the same piece of paper, deformed accordingly, to produce the impression of the object placed vertically, as in the original scene.</p>
<p>Let’s think, how the photograph should be transformed? Apparently, if we place the same piece of paper vertically, it would be pictured as the rectangular area with the same aspect ratio as the original piece of paper. Likewise, we can transform the picture using the following criterion: the trapezoidal shape representing the image of the piece of paper should be transformed into the rectangular shape with the same ratio as the original piece of paper. In other words, it should be precise “reverse perspective” transform.</p>
<p>Here is the second idea: how to pass the information on all required parameters of transfer to the software application?</p>
<p>First, we require the user to make a photograph of the same aspect ratio as the aspect ratio the original piece of paper. Additionally, we need the coordinates of the four points, defining the location and shape of the image of this piece of paper on the photograph. The user has to put some markers on these four points, the corners of the trapezoidal shape. That will be all we need.</p>
<h2 id="heading.how-to-create-the-illusion3f">How to Create the Illusion?</h2>
<p>So, the user needs to produce a photograph with symmetric trapezoidal shape of the image of reference piece of paper and mark its corners and make sure the aspect ratio values are the same for this piece of paper and the photograph. If should be done in one of the two ways, or their combination: a) the piece of paper should be cut to the aspect ratio of the frame, b) when the picture is taken, it can be cropped to aspect ratio as the original piece of paper. Usually, the second method is the simplest. When a picture is loaded in the software, its aspect ratio will conduct some important information on the scene.</p>
<p>This rules formulated above are approximate. They make <em>good</em> approximation under the following conditions:</p>
<ul>
<li>The effective focal distance of the lens is not too short; in practice, 100 mm (in 35 mm equivalent) or higher.</li><li>The lens is relatively close to <em>rectilinear</em> and has relatively low distortions; in practice, any reasonably priced interchangeable lens or embedded zoom lens can work well enough.</li><li>The depth of field should well cover the size of the piece of paper and all objects of interest.</li><li>The horizon of the scene should not be too low. In other words, the perspective effect should be distinct but moderate. In practice, the angular sizes of the closer and more distant horizontal sides of the piece of paper can be different by the factor of 2, but hardly considerably more.</li><li>The angular sizes of all objects of interest should be comparable with the angular sizes of the piece of paper; in other words, the piece of paper should occupy a big part of the scene.</li></ul>
<p>Aspect ratio values conduct important information used by the software to perform accurate image transformation. The remaining part can be passed via the software UI: the user needs to point to each of the four angles of the trapezoidal shape representing the piece of paper.</p>
<p>Finally, the resulting image should be photographed from the <em>same very point</em> as the original scene. It will make the <em>vantage point</em> best for the illusion. That’s why using a tripod will be the best choice. Now, let’s see how to perform all the steps, including the use of the software.</p>
<h2 id="heading.workflow">Workflow</h2>
<p>Photograph the object on some rectangular piece of paper. Make sure that the top and bottom edges of the piece of paper are parallel to the lower boundary of the frame. The image of this piece of paper shown in perspective should be symmetrical: <span><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.photograph.webp" alt="[photograph]"></span>. This requirement is approximate. Use a tripod. When the picture is taken, don’t move the tripod and mark the location of the piece of paper. You will need the same locations when you photograph the result.</p>
<p>Make sure your picture aspect ratio is the same as of the piece of paper photographed. If needed, crop the picture to required aspect ratio using any suitable image editor.</p>
<p id="image.step1">Load your source picture by AnamorphicDrawing.exe:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step1.webp" alt="Load"></p>
<p id="image.step2">Mark four corners of the image of the paper by placing corresponding corner grips. You can quickly start by clicking on each corner clockwise, starting from the top-left one. Don't worry about accuracy: you can fix it later:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step2.webp" alt="Mark corners"></p>
<p id="image.step3">Using Tab key or mouse, activate each of the corner grips and adjust their locations accurately, using arrow keys:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step3.webp" alt="Adjust corners"></p>
<p>The adjustment of a grip position can be performed quickly but with the accuracy of one screen pixel — that’s why it will be the best to work with maximizes main application window. There are four steps of the motion; please see the detailed description in the <a href="https://sakryukov.github.io/software/Anamorphic-Drawing-for-the-Cheaters#heading.corner-grips">documentation on the user interface</a>.</p>
<p id="image.step4">Hit "Next" to obtain an anamorphic image. The piece of paper is transformed to appear as a rectangular shape with the same aspect ratio as the source image:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step4.webp" alt="Transform"></p>
<p>Note that the shape of the apple becomes not only elongated, but it is also wider on the top end. This is natural: normal perspective projection makes the image <a href="https://en.wikipedia.org/wiki/Perspective_%28graphical%29#Foreshortening">foreshortened</a>, with reduced sizes of more distant parts of the object. No wonder, our reverse perspective transform should do the opposite.</p>
<p id="image.step5">Move four crop grips to define crop:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step5.webp" alt="Define crop"></p>
<p id="image.step6">Now a crop is defined, matching the edges of the piece of paper. On this image, one can see that the transformed image is not strictly rectangular. This is the effect of some distortion in optics.</p>
<p>Hit “Next”:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step6.webp" alt="Crop"></p>
<p id="image.step6">Now the anamorphic image is cropped and scaled. You can save it or, optionally, print out immediately:</p>
<p><img src="./Resources-articles/2018-03-04.Anamorphic-Drawing-for-the-Cheaters.step7.webp" alt="Save and print"></p>
<p>The image should be scaled for printing, to approximately match the size of the original piece of paper which was photographed. Anamorphic image is considerably taller than this piece of paper.</p>
<p>For good results, it’s better to keep the perspective moderate; otherwise anamorphic image comes out too tall, which, in turn, leads to high distortions.</p>
<p>The printed image can be used as it is. Alternatively, the same image can be processed to obtain contours of the image, which can be made very pale, to serve as a convenient pad for manual drawing. The first image, full-colored one, can be used as a reference, a model for drawing.</p>
<p>The picture on paper is prepared. Then it needs to be cut out, to remove the background areas. On the pictures shown above, this is the brown-colored area.</p>
<p>The anamorphic image can now be photographed. Assuming the tripod is still in the same position, and the zoom level of the lens is the same as in first place, we can place resulting print using the same position and orientation as the original image.</p>
<h2 id="heading.implementation">Implementation</h2>
<h3 id="heading.perspective-transform">Perspective Transform</h3>
<p>The heart of the software is some transformation of the image, which is not an <em>affine transform</em>. Non-affine transformations are not readily available through typical imaging libraries. <a href="https://en.wikipedia.org/wiki/Affine_transformation">Affinity function</a> between <a href="https://en.wikipedia.org/wiki/Affine_space">affine spaces</a> preserves points, straight lines and planes, which is the case with the perspective transform we need. From the other hand, if some transformation is affine, a set of parallel lines remains parallel after the transformation, which is not the case.</p>
<p>One example of such transformation is shown above as a transition between the image <a href="#image.step3">before transformation</a> and <a href="#image.step4">after transformation</a>.<br>
Here, the brown rectangle represents the entire image transformed into a trapezoidal shape. The image of the piece of paper under the apple object is transformed from trapezoidal shape to a rectangle (with certain accuracy), which is, obviously, the case only for some special shapes.</p>
<p>I ended up rolling out my own transformation function implemented on the pixel level of WPF <code>System.Windows.Media.Imaging</code>, only for a specific special case. For this case, we assume that the image of the piece of paper (light color) is strictly symmetrical; and the trapezoid base line is parallel to the lower edge of the photograph. In this case, it is enough to re-sample each horizontal pixel <em>stride</em> of the original image symmetrically. Let’s say, we have some separate re-sampling ratio values for the upper and lower edges of the photograph. All the strides in between should have re-sampling ratio linearly interpolated between the upper and lower ratio.</p>
<div class="pre-lang" id="premain157887"><div>C#</div><div class="pre-action-link"><span class="code-collapse" data-index="157887" id="preShrink157887">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="157887" id="copycode157887" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre157887" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">namespace</span> AnamorphicDrawing.Main {
    <span class="code-keyword">using</span> System;
    <span class="code-keyword">using</span> System.Windows;
    <span class="code-keyword">using</span> System.Windows.Media.Imaging;

    <span class="code-keyword">class</span> PerspectiveTransform {

        <span class="code-keyword">internal</span> PerspectiveTransform(
            <span class="code-keyword">double</span> horizontalScaleFrom,
            <span class="code-keyword">double</span> horizontalScaleTo)
        {
            <span class="code-keyword">this</span>.horizontalScaleFrom = horizontalScaleFrom;
            <span class="code-keyword">this</span>.horizontalScaleTo = horizontalScaleTo;
            <span class="code-keyword">this</span>.maxHorizontalScale =
                Math.Max(horizontalScaleFrom, horizontalScaleTo);
        } <span class="code-comment">//</span><span class="code-comment">PerspectiveTransform</span>

        <span class="code-keyword">internal</span> BitmapSource Apply(BitmapSource source) {
            <span class="code-keyword">int</span> destinationWidth =
                (<span class="code-keyword">int</span>)Math.Round(maxHorizontalScale * source.PixelWidth);
            WriteableBitmap destination = <span class="code-keyword">new</span> WriteableBitmap(
                destinationWidth, source.PixelHeight,
                source.DpiX, source.DpiY, source.Format, source.Palette);
            <span class="code-keyword">int</span> bytesPerPixel =
                destination.BackBufferStride / destinationWidth;
            <span class="code-keyword">int</span> sourceStride = bytesPerPixel * source.PixelWidth;
            <span class="code-keyword">int</span> destinationStride = bytesPerPixel * destinationWidth;
            <span class="code-keyword">byte</span>[] sourceArray = <span class="code-keyword">new</span> <span class="code-keyword">byte</span>[sourceStride];
            <span class="code-keyword">byte</span>[] destinationArray = <span class="code-keyword">new</span> <span class="code-keyword">byte</span>[destinationStride];
            <span class="code-keyword">byte</span> fillByte = (source.Format.Masks.Count == <span class="code-digit">4</span>) ?
                (<span class="code-keyword">byte</span>)<span class="code-digit">0</span> : (<span class="code-keyword">byte</span>)0xff;
            <span class="code-keyword">double</span> factor = (horizontalScaleTo - horizontalScaleFrom) /
                source.PixelHeight;
            <span class="code-keyword">if</span> (UseInterpolation == Interpolation.Linear)
                LinearInterpolation(
                    factor, bytesPerPixel, source, destination,
                    destinationWidth, sourceArray, destinationArray,
                    sourceStride, destinationStride, fillByte);
            <span class="code-keyword">else</span>
                NearestNeighborInterpolation(
                    factor, bytesPerPixel, source, destination,
                    destinationWidth, sourceArray, destinationArray,
                    sourceStride, destinationStride, fillByte);
            <span class="code-keyword">return</span> destination;
        } <span class="code-comment">//</span><span class="code-comment">Apply</span>

        <span class="code-keyword">void</span> NearestNeighborInterpolation(...) {
            <span class="code-comment">//</span><span class="code-comment"> ...</span>
        } <span class="code-comment">//</span><span class="code-comment">NearestNeighborInterpolation</span>

        <span class="code-keyword">void</span> LinearInterpolation(
            <span class="code-keyword">double</span> factor, <span class="code-keyword">int</span> bytesPerPixel, BitmapSource source,
            WriteableBitmap destination, <span class="code-keyword">int</span> destinationWidth,
            <span class="code-keyword">byte</span>[] sourceArray, <span class="code-keyword">byte</span>[] destinationArray, <span class="code-keyword">int</span> sourceStride,
            <span class="code-keyword">int</span> destinationStride, <span class="code-keyword">byte</span> fillByte)
        {
            <span class="code-keyword">for</span> (<span class="code-keyword">int</span> y = <span class="code-digit">0</span>; y <span class="code-keyword">&lt;</span> destination.PixelHeight - <span class="code-digit">1</span>; ++y) {
                <span class="code-keyword">double</span> compression = horizontalScaleFrom + factor * y;
                <span class="code-keyword">int</span> sourcePixelWidthMinusOne = source.PixelWidth;
                source.CopyPixels(
                    <span class="code-keyword">new</span> Int32Rect(
                        <span class="code-digit">0</span>, y, source.PixelWidth, <span class="code-digit">1</span>),
                        sourceArray, sourceStride, <span class="code-digit">0</span>);
                <span class="code-keyword">for</span> (<span class="code-keyword">int</span> х = <span class="code-digit">0</span>; х <span class="code-keyword">&lt;</span> destinationWidth; ++х) {
                    <span class="code-keyword">double</span> shift = (source.PixelWidth *
                        compression - destinationWidth) / 2d;
                    <span class="code-keyword">double</span> xSrc = (х + shift) / compression;
                    <span class="code-keyword">int</span> xSrcCurrent = (<span class="code-keyword">int</span>)xSrc;
                    <span class="code-keyword">int</span> xSrcNext = (xSrcCurrent == sourcePixelWidthMinusOne) ?
                        xSrcCurrent : xSrcCurrent + <span class="code-digit">1</span>;
                    <span class="code-keyword">double</span> deltaX = xSrc - xSrcCurrent;
                    <span class="code-keyword">for</span> (<span class="code-keyword">byte</span> byteIndex = <span class="code-digit">0</span>; byteIndex <span class="code-keyword">&lt;</span> bytesPerPixel; ++byteIndex)
                        <span class="code-keyword">if</span> (xSrcCurrent <span class="code-keyword">&gt;</span>= <span class="code-digit">0</span> &amp;&amp; xSrcNext <span class="code-keyword">&lt;</span> source.PixelWidth) {
                            <span class="code-keyword">if</span> (xSrcCurrent != xSrcNext) {
                                <span class="code-keyword">double</span> y1 =
                                    sourceArray[
                                        xSrcCurrent * bytesPerPixel + byteIndex
                                    ];
                                <span class="code-keyword">double</span> y2 = sourceArray[
                                    xSrcNext * bytesPerPixel + byteIndex
                                    ];
                                destinationArray[х * bytesPerPixel + byteIndex]
                                    = (<span class="code-keyword">byte</span>)(y1 + (y2 - y1) * deltaX);
                            } <span class="code-keyword">else</span>
                                destinationArray[х * bytesPerPixel + byteIndex]
                                = sourceArray
                                    [xSrcCurrent * bytesPerPixel + byteIndex];
                        } <span class="code-keyword">else</span>
                            destinationArray[х * bytesPerPixel + byteIndex] = fillByte;
                } <span class="code-comment">//</span><span class="code-comment">loop x</span>
                destination.WritePixels(
                    <span class="code-keyword">new</span> Int32Rect(<span class="code-digit">0</span>, y, destinationWidth, <span class="code-digit">1</span>),
                        destinationArray, destinationStride, <span class="code-digit">0</span>);
            } <span class="code-comment">//</span><span class="code-comment">loop y</span>
        } <span class="code-comment">//</span><span class="code-comment">LinearInterpolation</span>

        <span class="code-keyword">internal</span> <span class="code-keyword">double</span> HorizontalScaleFrom { <span class="code-keyword">get</span> { <span class="code-keyword">return</span> horizontalScaleFrom; } }
        <span class="code-keyword">internal</span> <span class="code-keyword">double</span> HorizontalScaleTo { <span class="code-keyword">get</span> { <span class="code-keyword">return</span> horizontalScaleTo; } }
        <span class="code-keyword">internal</span> <span class="code-keyword">enum</span> Interpolation { Linear, NearestNeighbor, }
        <span class="code-keyword">internal</span> Interpolation UseInterpolation { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }

        <span class="code-keyword">double</span> horizontalScaleFrom, horizontalScaleTo, maxHorizontalScale;

    } <span class="code-comment">//</span><span class="code-comment">class PerspectiveTransform</span>

} <span class="code-comment">//</span><span class="code-comment">namespace AnamorphicDrawing.Main</span></pre>
<p>The pixel res-sampling for the transform is implemented with two interpolation algorithms: nearest-neighbor (not shown above) and more accurate linear interpolation. In fact, nearest-neighbor is not used; it was developed as a first step.</p>
<p>The transformation shown above accepts only two parameters: two aspect ratio values <code>horizontalScaleTo</code> and <code>horizontalScaleTo</code>. First one is calculated for the upper edge of the photograph, and the second one – for the lower edge. The maximum of these two values is used to make sure all sizes are scaled only down because the downscale re-sampling is more accurate.</p>
<p>To calculate these two re-sample ratio values, we need parameters passed from the user to the software. It includes only 9 numbers: aspect ratio of the image which software finds from the image itself, and coordinates of the four corner points taken from the user input, <a href="#image.step3">as shown above</a>.</p>
<h3 id="heading.geometry">Geometry</h3>
<p>The aspect ratio of the image and four corner points are used to calculate the geometry for the perspective transfer, which is done by the class <code>MarkFactorSet</code>. The calculated geometry parameters are passed to calculate re-sampling ratio values.</p>
<p>The UI layer picks up corners data to calculate resulting transformed bitmap:</p>
<div class="pre-lang" id="premain135262"><div>C#</div><div class="pre-action-link"><span class="copy-code" data-index="135262" id="copycode135262" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre135262" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate">BitmapSource TransformImplementation() {
   <span class="code-keyword">return</span> Main.ImageProcessingUtility.PerspectiveTransformFromRelativePoints(
       collaboration.BitmapSource, topLeft.Location, topRight.Location,
       bottomRight.Location, bottomLeft.Location, image.Width);
} <span class="code-comment">//</span><span class="code-comment">TransformImplementation</span></pre>
<p>The method <code>PerspectiveTransformFromRelativePoints</code> adds the aspect ratio of the image, calculates the geometry and obtains the re-sampling ratio factors:</p>
<div class="pre-lang" id="premain606670"><div>C#</div><div class="pre-action-link"><span class="copy-code" data-index="606670" id="copycode606670" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre606670" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">internal</span> <span class="code-keyword">static</span> BitmapSource PerspectiveTransformFromRelativePoints(
    BitmapSource bitmap, Point topLeft, Point topRight, Point bottomRight,
    Point bottomLeft, <span class="code-keyword">double</span> imageWidth)
{
    <span class="code-keyword">double</span> bitmapAspect = (<span class="code-keyword">double</span>)bitmap.PixelWidth / (<span class="code-keyword">double</span>)bitmap.PixelHeight;
    MarkFactorSet factorSet = <span class="code-keyword">new</span> MarkFactorSet(topLeft, topRight, bottomRight,
        bottomLeft, bitmap.PixelHeight, bitmapAspect, bitmap.PixelWidth / imageWidth);
    <span class="code-keyword">if</span> (!factorSet.IsValid) <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
    <span class="code-keyword">return</span> <span class="code-keyword">new</span> PerspectiveTransform(
        factorSet.HorizontalScaleFrom, factorSet.HorizontalScaleTo).
            Apply(bitmap);
}</pre>
<p>The class <code>MarkFactorSet</code> uses pretty simple school geometry to calculate the scale factors. Please see the full source code for further detail.</p>
<h3 id="heading.user-interface">User Interface</h3>
<p>The user interface is fairly simple and yet pretty interesting in terms of the project development methods and maintainability.</p>
<p>First of all, it is implemented as a single main WPF window, not counting two help windows. The design of the 3-step wizard is based on three instances of <code>UserControl</code> stacked on top of each other. The wizard navigation (“Previous”/“Next”) is performed by controlling the visibility of these <code>UserControl</code> instances.</p>
<p>This application can be used as a demonstration of the technique of description of the graphical detail of behavior in XAML, backed by <em>dependency properties</em>, <code>DependencyProperty</code>.</p>
<p>This is how the change in states of the grippers automatically shows a visual clue to the user. Let’s review this technique on the example of the more feature-rich corner gripper. With this approach, we can isolate the visual aspects of the behavior of these controls from non-visual ones. To emphasize such isolation, I also split parts of the same control class into two different files, using the <code>partial</code> class C# feature.</p>
<p>Here is how it looks:</p>
<div class="pre-lang" id="premain317324"><div>C#</div><div class="pre-action-link"><span class="copy-code" data-index="317324" id="copycode317324" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre317324" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">internal</span> <span class="code-keyword">abstract</span> <span class="code-keyword">class</span> BaseGrip : ResizeGrip {
    <span class="code-comment">//</span><span class="code-comment"> this class defines keyboard handling,</span>
    <span class="code-comment">//</span><span class="code-comment"> all those move steps, and the like</span>
}</pre>
<p>Derived class <code>BaseGrip</code> overrides the detail of keyboard handling specific to its behavior:</p>
<div class="pre-lang" id="premain650667"><div>C#</div><div class="pre-action-link"><span class="copy-code" data-index="650667" id="copycode650667" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre650667" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">internal</span> <span class="code-keyword">partial</span> <span class="code-keyword">class</span> CropGrip : BaseGrip {

    <span class="code-keyword">protected</span> <span class="code-keyword">override</span> <span class="code-keyword">void</span> OnMouseDown(System.Windows.Input.MouseButtonEventArgs e) {
        Focus();
    } <span class="code-comment">//</span><span class="code-comment">OnMouseDown</span>

    <span class="code-keyword">protected</span> <span class="code-keyword">override</span> <span class="code-keyword">bool</span> IsGoodMotionKey(KeyEventArgs e) {
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.Direction == GripDirection.Horizontal) {
            <span class="code-keyword">if</span> (e.Key == Key.System) {
                <span class="code-keyword">return</span> e.SystemKey == Key.Left || e.SystemKey == Key.Right;
            } <span class="code-keyword">else</span> {
                <span class="code-keyword">return</span> e.Key == Key.Down || e.Key == Key.Left || e.Key == Key.Right;
            } <span class="code-comment">//</span><span class="code-comment"> if System</span>
        } <span class="code-keyword">else</span> {
            <span class="code-keyword">if</span> (e.Key == Key.System) {
                <span class="code-keyword">return</span> e.SystemKey == Key.Up || e.SystemKey == Key.Down;
            } <span class="code-keyword">else</span> {
                <span class="code-keyword">return</span> e.Key == Key.Up || e.Key == Key.Down;
            } <span class="code-comment">//</span><span class="code-comment"> if System</span>
        } <span class="code-comment">//</span><span class="code-comment">if Direction</span>
    } <span class="code-comment">//</span><span class="code-comment">IsGoodMotionKey</span>

} <span class="code-comment">//</span><span class="code-comment">CropGrip</span></pre>
<p>And finally, we need to augment the same class with properties used in XAML:</p>
<div class="pre-lang" id="premain339999"><div>C#</div><div class="pre-action-link"><span class="code-collapse" data-index="339999" id="preShrink339999">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="339999" id="copycode339999" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="C#" id="pre339999" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">partial</span> <span class="code-keyword">class</span> CropGrip {

    <span class="code-keyword">enum</span> GripRoleValue : <span class="code-keyword">byte</span> {
        HighValueMask = 0x0f,
        OrientationMask = 0xf0,
        HighValue = <span class="code-digit">1</span>,
        Vertical = 0x10,
        Horizontal = 0x20,
    } <span class="code-comment">//</span><span class="code-comment">GripRoleValue</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">enum</span> GripRole : <span class="code-keyword">byte</span> {
        Left = GripRoleValue.Horizontal,
        Right = GripRoleValue.Horizontal | GripRoleValue.HighValue,
        Top = GripRoleValue.Vertical,
        Bottom = GripRoleValue.Vertical | GripRoleValue.HighValue
    } <span class="code-comment">//</span><span class="code-comment">enum GripRole</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">enum</span> GripDirection :
        <span class="code-keyword">byte</span> { Horizontal = GripRoleValue.Horizontal, Vertical = GripRoleValue.Vertical, }

    <span class="code-keyword">static</span> FrameworkPropertyMetadata RolePropertyMetadata = <span class="code-keyword">new</span> FrameworkPropertyMetadata();

    <span class="code-keyword">static</span> DependencyProperty RoleProperty =
        DependencyProperty.Register(
            <span class="code-string">"</span><span class="code-string">Role"</span>,
            <span class="code-keyword">typeof</span>(GripRole),
            <span class="code-keyword">typeof</span>(CropGrip),
            RolePropertyMetadata);

    <span class="code-keyword">internal</span> GripRole Role {
        <span class="code-keyword">get</span> { <span class="code-keyword">return</span> (GripRole)GetValue(RoleProperty); }
        <span class="code-keyword">set</span> { SetValue(RoleProperty, <span class="code-sdkkeyword">value</span>); }
    } <span class="code-comment">//</span><span class="code-comment">Role</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">bool</span> IsHighValueRole { <span class="code-keyword">get</span> {
        <span class="code-keyword">return</span> ((<span class="code-keyword">byte</span>)Role &amp; (<span class="code-keyword">byte</span>)GripRoleValue.HighValueMask) <span class="code-keyword">&gt;</span> <span class="code-digit">0</span>; }
    }
    <span class="code-keyword">internal</span> GripDirection Direction { <span class="code-keyword">get</span> {
        <span class="code-keyword">return</span> (GripDirection)((<span class="code-keyword">byte</span>)Role &amp; (<span class="code-keyword">byte</span>)GripRoleValue.OrientationMask); }
    }

} <span class="code-comment">//</span><span class="code-comment">CropGrip</span></pre>
<p>To use it in XAML, we need <code>Setter</code> and <code>MultiTrigger</code> elements. Importantly, instead of applying them to each grip element, we should better define the common style for all of them:</p>
<div class="pre-lang" id="premain189549"><div>XML</div><div class="pre-action-link"><span class="code-collapse" data-index="189549" id="preShrink189549">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="189549" id="copycode189549" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="XML" id="pre189549" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">&lt;</span><span class="code-leadattribute">ResourceDictionary</span><span class="code-keyword">&gt;</span>
    <span class="code-comment">&lt;!--</span><span class="code-keyword"><span class="code-comment"> ... </span><span class="code-comment">--&gt;</span></span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Style</span><span class="code-attribute"> </span><span class="code-attribute">x:Key</span><span class="code-keyword">="</span><span class="code-keyword">grip"</span><span class="code-attribute"> </span><span class="code-attribute">TargetType</span><span class="code-keyword">="</span><span class="code-keyword">ui:LocationGrip"</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Cursor"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">SizeAll"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Width"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource locationGripSelectionSize}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Height"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource locationGripSelectionSize}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">Style.Triggers</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger.Conditions</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Condition</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsMouseOver"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">true"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Condition</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">true"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger.Conditions</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger.Setters</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Background"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">Red"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger.Setters</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger.Conditions</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Condition</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsMouseOver"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">true"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Condition</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">false"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger.Conditions</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiTrigger.Setters</span><span class="code-keyword">&gt;</span>
                    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Background"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">Green"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger.Setters</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/MultiTrigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">Trigger</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsMouseOver"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">false"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Background"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">Transparent"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Trigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">Trigger</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">true"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Foreground"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">Navy"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Trigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">Trigger</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">false"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Foreground"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">DarkGray"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Trigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">Trigger</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">true"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Template"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource ResourceKey=focusedSelected}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Trigger</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">Trigger</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">IsSelected"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">false"</span><span class="code-keyword">&gt;</span>
                <span class="code-keyword">&lt;</span><span class="code-leadattribute">Setter</span><span class="code-attribute"> </span><span class="code-attribute">Property</span><span class="code-keyword">="</span><span class="code-keyword">Template"</span><span class="code-attribute"> </span><span class="code-attribute">Value</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource ResourceKey=unSelected}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
            <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Trigger</span><span class="code-keyword">&gt;</span>
        <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Style.Triggers</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">/Style</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/ResourceDictionary</span><span class="code-keyword">&gt;</span></pre>
<p>Having the style, we can apply it to actual grip elements.</p>
<div class="pre-lang" id="premain307938"><div>XML</div><div class="pre-action-link"><span class="copy-code" data-index="307938" id="copycode307938" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre lang="XML" id="pre307938" data-codeblock-processed="true" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">&lt;</span><span class="code-leadattribute">UserControl</span><span class="code-attribute"> </span><span class="code-attribute">x:Class</span><span class="code-keyword">="</span><span class="code-keyword">AnamorphicDrawing.Ui.CropStep"</span><span class="code-attribute"> </span><span class="code-attribute">xmlns</span><span class="code-keyword">="</span><span class="code-keyword">http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span><span class="code-attribute"> </span><span class="code-attribute">xmlns:x</span><span class="code-keyword">="</span><span class="code-keyword">http://schemas.microsoft.com/winfx/2006/xaml"</span><span class="code-attribute"> </span><span class="code-attribute">xmlns:system</span><span class="code-keyword">="</span><span class="code-keyword">clr-namespace:System;assembly=mscorlib"</span><span class="code-attribute"> </span><span class="code-attribute">xmlns:ui</span><span class="code-keyword">="</span><span class="code-keyword">clr-namespace:AnamorphicDrawing.Ui"</span><span class="code-keyword">&gt;</span>

<span class="code-comment">&lt;!--</span><span class="code-keyword"><span class="code-comment"> ... </span><span class="code-comment">--&gt;</span></span>

<span class="code-keyword">&lt;</span><span class="code-leadattribute">ui:CropGrip</span><span class="code-attribute"> </span><span class="code-attribute">x:Name</span><span class="code-keyword">="</span><span class="code-keyword">left"</span><span class="code-attribute"> </span><span class="code-attribute">Role</span><span class="code-keyword">="</span><span class="code-keyword">Left"</span><span class="code-attribute"> </span><span class="code-attribute">Cursor</span><span class="code-keyword">="</span><span class="code-keyword">SizeWE"</span><span class="code-attribute"> </span><span class="code-attribute">Style</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource vertical}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">ui:CropGrip</span><span class="code-attribute"> </span><span class="code-attribute">x:Name</span><span class="code-keyword">="</span><span class="code-keyword">top"</span><span class="code-attribute"> </span><span class="code-attribute">Role</span><span class="code-keyword">="</span><span class="code-keyword">Top"</span><span class="code-attribute"> </span><span class="code-attribute">Cursor</span><span class="code-keyword">="</span><span class="code-keyword">SizeNS"</span><span class="code-attribute"> </span><span class="code-attribute">Style</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource horizontal}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">ui:CropGrip</span><span class="code-attribute"> </span><span class="code-attribute">x:Name</span><span class="code-keyword">="</span><span class="code-keyword">right"</span><span class="code-attribute"> </span><span class="code-attribute">Role</span><span class="code-keyword">="</span><span class="code-keyword">Right"</span><span class="code-attribute"> </span><span class="code-attribute">Cursor</span><span class="code-keyword">="</span><span class="code-keyword">SizeWE"</span><span class="code-attribute"> </span><span class="code-attribute">Style</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource vertical}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">ui:CropGrip</span><span class="code-attribute"> </span><span class="code-attribute">x:Name</span><span class="code-keyword">="</span><span class="code-keyword">bottom"</span><span class="code-attribute"> </span><span class="code-attribute">Role</span><span class="code-keyword">="</span><span class="code-keyword">Bottom"</span><span class="code-attribute"> </span><span class="code-attribute">Cursor</span><span class="code-keyword">="</span><span class="code-keyword">SizeNS"</span><span class="code-attribute"> </span><span class="code-attribute">Style</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource horizontal}"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>

<span class="code-comment">&lt;!--</span><span class="code-keyword"><span class="code-comment"> ... </span><span class="code-comment">--&gt;</span></span>

<span class="code-keyword">&lt;</span><span class="code-leadattribute">/UserControl</span><span class="code-keyword">&gt;</span></pre>
<h3 id="heading.user-interface-design3a-collaboration-and-grip-couplers">User Interface Design: Collaboration and Grip Couplers</h3>
<p>There is a number of other interesting design constructs created for this project. In particular, the interface <code>ICollaborationProvider</code> and the class <code>Collaboration</code> provide collaboration between instances of <code>UserControl</code>, representing three wizard steps. This collaboration is important because they share the same <code>BitmapSource</code> object. For this purpose, all three <code>UserControl</code> step classes implement the interface <code>ICollaborationProvider</code>. In this approach, all three classes remain isolated, providing access only to the essential properties required by collaboration.</p>
<p>The classes <code>CropGripCoupler</code> and <code>LocationGripCoupler</code> play similar roles. The class <code>CropGripCoupler</code> couple the location of all four corner grips with the location of lines connecting them. These lines are important to the user who needs a visual clue of the order of grips. It is also helpful to match these lines precisely with the edges of the trapezoidal shape. Likewise, the class <code>LocationGripCoupler</code> couples the behavior of the crop grips with the crop rectangle. This is actually the example of <a href="https://en.wikipedia.org/wiki/Loose_coupling">loose coupling</a>, with all its benefits. Indeed, it would be much more difficult to develop controls embedding all four grips of each type, losing the opportunity to develop each grip class as a fairly simple separate independent control class.</p>
<p>It is pretty difficult to explain all the interesting detail in a single article. Please refer to the source code, directories “AnamorphicDrawing/UI” and “AnamorphicDrawing/UI.Control”. I’ll gladly try to answer all questions on this matter.</p>
<h3 id="heading.build-and-compatibility">Build and Compatibility</h3>
<p>As the code is based on WPF, I used the first platform version decently compatible with WPF — Microsoft.NET v.3.5. Correspondingly, I provided a solution and a project for Visual Studio 2008. I’ve done it intentionally, to cover all the readers who could use WPF. Later .NET versions will be supported; later versions of Visual Studio can automatically upgrade solution and project files.</p>
<p>In fact, Visual Studio is not required for the build. The code can be batch-built, by using the provided batch file “build.bat”. If your Windows installation directory is different from the default, the build will still work. If .NET installation directory is different from default one, please see the content of this batch file and the comment in its first line — next line can be modified to get the build.</p>

<!-- Article Ends -->


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article has no explicit license attached to it but may contain usage terms in the article text or the download files themselves. If in doubt please contact the author via the discussion board below.</p><p>A list of licenses authors might use can be found <a href="https://www.codeproject.com/info/Licenses.aspx">here</a></p></div>
						

						
						<br>
						
						    <br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    
				</div>
				
                
                

				
				
				

			</div>
			

            
            
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters">Permalink</a><br>
				<br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/1278552/Anamorphic-Drawing-for-the-Cheaters?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2019 by Sergey Alexandrovich Kryukov<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2024<br>
                <br>
				Web01 
				2.8:2024-12-08:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>







<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>