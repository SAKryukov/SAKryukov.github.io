<!DOCTYPE html>
<!-- saved from url=(0056)https://www.codeproject.com/Articles/1179876/Unicode-Art -->
<html lang="en" data-lt-installed="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	
	<link rel="preconnect" href="https://www.google-analytics.com/">

	<link rel="preconnect" href="https://www.codeproject.com/">


	<link rel="preload" href="./Resources/logo250x135.gif" as="image">


	<link rel="preload" href="https://www.codeproject.com/App_Themes/CodeProject/Img/logo135-bg.gif" as="image">
	<link rel="preload" href="./Resources/jquery-3.4.1.min.js.download" as="script" type="text/javascript">


	<title>Unicode Art- CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="./Resources/Article.min.css">


    <script type="text/javascript" async="" src="./Resources/analytics.js.download"></script><script type="text/javascript" src="./Resources/jquery-3.4.1.min.js.download" defer=""></script>
<script type="text/javascript" src="./Resources/article.min.js.download" defer=""></script>

	
<meta http-equiv="content-language" content="en-US">

<meta name="Description" content="Similar to ASCII Art, Unicode Art offers better tonal range, impressive look, and some fun on this sunny April day">
<meta name="Keywords" content="">
<meta name="Author" content="Sergey Alexandrovich Kryukov">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">



<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Articles/1179876/Unicode-Art">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@CodeProject">
<meta name="og:site_name" content="CodeProject">
<meta name="twitter:creator" content="@CodeProject">
<meta property="og:type" content="article">
<meta property="article:published_time" content="4/1/2017 12:39:00 AM">
<meta property="article:modified_time" content="2/20/2021 2:20:00 PM">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Sergey Alexandrovich Kryukov">
<meta property="og:url" content="https://www.codeproject.com/Articles/1179876/Unicode-Art">
<meta property="og:title" content="Unicode Art">
<meta property="og:description" content="Similar to ASCII Art, Unicode Art offers better tonal range, impressive look, and some fun on this sunny April day">


<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/1179876/Unicode-Art"
   },
  "name": "Unicode Art",
  "headline": "Unicode Art",
  "url": "https://www.codeproject.com/Articles/1179876/Unicode-Art",
  "discussionUrl": "#_comments",
  "isFamilyFriendly": "true",
  "image": "https://www.codeproject.com/App_Themes/CodeProject/Img/Article100.png",
  "commentCount": "0",
  "editor" : {
    "@type" : "Person",
    "name" : "Editor",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
  },
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "Similar to ASCII Art, Unicode Art offers better tonal range, impressive look, and some fun on this sunny April day",
  "author" : [{
      "@type" : "Person",
      "name" : "Sergey Alexandrovich Kryukov",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=2291164"
    }],
  "datePublished": "2017-04-01",
  "dateCreated": "2017-04-01",
  "dateModified": "2021-02-20"
}</script>

<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





    <script async="" type="text/javascript" src="./Resources/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '42a7d533-9829-4f88-8fc6-84dc936250c9'});
    </script>

<style type="text/css"></style></head>	

<body class="chrome chrome120" data-new-gr-c-s-check-loaded="14.1215.0" data-gr-ext-installed="">



<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="./Resources/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed narrow">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">65,938 articles</div>
	
	<div id="ctl00_MemberBar_ChangeNotice" class="flex-item align-left">CodeProject
	is changing. <a href="https://www.codeproject.com/info/Changes.aspx">Read more</a>.</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed narrow">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Resources/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"></div>
        </div>
    </div>

	
			
	

	<div id="A" class="container-content-wrap fixed narrow"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a rel="nofollow" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    
</div>



 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/1179876/Unicode-Art?display=Print" class="tooltip" title="">
   <img src="./Resources/print48.png" width="24" height="24" style="border:0">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
		    
            

			
			<div id="AT" class="article-container  fixed narrow" style="max-width:inherit;"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="https://www.codeproject.com/Articles/1179876/View.aspx" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="bu8Wm6vsQf+DugH6JIReE0IrNgMKcO1CaBEfQKrg994MPAKLh7B0MELTQsukv/WWDpVqYLoVYPlYaikNQfhJELmfmB3lwOnZPPKfKqwGtlT7XDS14ROvR5eucHAhOAAt197UqYRz4md+5jROZCxEYRAw1qo5x8njVVomSnxaeJinfdWXmz0Qd3G8DuXN+HyHIWQBZw2ZGXTNwhUf9E65ptemsGuR+XauaqnJRC5MNttoW/18ahci29Np2Ho/AG6wM/7xYr7J5PTvwtJGNFDaeo6ehkv4GxQA83+DazP3JzZoyCYmim3H/t7HN3y0aTsfx+5wp4xyLo/GxKEMgdPhTUjCwPNOcT9xH7yIwuDA9IKkQ9Wst0XR/C72FhxtAlAmIpI1VlrZhXVeBmGROJsKWtkE6BoX/DC3kYAmNuNjQzFdkky0MLHaOEEEbvxKnIjeKqFody8rSS/rRN2jeHHJEbActCZv1H2dV8zPA3yJspBEJrpNjTLGBOTmxrMkFxJJwX15nTtM9u4aeLFqb5MHUL2tNSrJJNEPDDjCAziTsuNFA+ZgEvBvv32P6YQnypYJCPX4BXkHOoiRWGRe6nnTg4m2G1L3cHKtr+Q/iz/RydMZGCeeEF8G0u4WwQnNw9DQECVQucCU0j9dxW8uIzESAzsEk0X1Xp/S1L7aFvV+cVwqPH6iz05DODNCsLVOfA1tv5qNxWjwbTEkoWf7wDVXIAqbXXzJs12/HSwRY7upHrDgV3kPQOToqEEwqkeeCWVytjKWQKNJg/AmiEJOjmd/wrnRG0NvMSCTeg8vlVp5oixapQ313K+t9Fw14fCR2v4FvwFu0YABFkeOupEx2EjRkhuvJHZVHQAZYkZiYKlIHxfVdgV0MyDCm3EzwT2Cd8akV6vj7ELWnVJZhAf2trghBao1aKsN+gGAYC2aatAtdsx0XdWb0LD7NLjMfNawBNxRmwhJsvmpz27GDez+jOG2GCEgZ3JGXot+XUAlT1dX9pDCN6saTwqa3jFP8fIdLeOSK1DcTL9FFwEhSqjNVudmxUradMR7qqNONyzCV9xBQA0ruaYR7BDVPeEokzV0eujppuGkyClg0OFcMyRTuvs6xw3vTsKpVD8SsB/wq1aD0Z+QmZNYrGO50ORkWVtGaSxryIGOwDJ994EL45A446yyXIS6UEx/L12OORzr7M+BEKEbX5G3ucI2NGHQF1L5S0kfxMRpVKYicoimhzjKpKiIHcu7rJU8u7rmeujwXLb0qTMFBXoBZHUnTMnnVJ201FmpIeD+ZN6itvtkQ/O8lnytORUehD0Bf1zIOmn0xF4OAwkVAEyQwo4lR/bOEzcu1plLxv01TE+Kyid7jVZwWT/TGo/LYGTkG85KWjgSaE440cm30BLFA3RBkoayGN12TLL2RtA/GjbOsnbIffLz+j31DwLgJ9KGLpf8oKISCJq+6lWwVw1GJcAs/CSAyQuJAJOVm+aSQ25P/lRxYCe0NqKP/v1XKhh9e+Wu2uA6ehoeSmfE5FGEU9UIgJme1kt4vz+5lpHff4zxjwFKFy8uPEu9NF2v/GYdBWEu0GMPw1gP7Vn+N6C58BmSltpvGa+pkwvsl3j1jjz71I42lcd5uKs1wzmtuJ1pEN8IsviluWOnEiTlaSQJ">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>
					    <a name="_articleTop" id="_articleTop"></a>

					    
						<div>
							<span id="ctl00_TagListHorz_TagWrp">

	
	

	
	<span id="ctl00_TagListHorz_VisibleTags" class="subdue">(untagged)</span> 

	
	
</span>


						</div>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">Unicode Art</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

								

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2291164" rel="author">Sergey Alexandrovich Kryukov</a></span> 

                                        <div class="flex-item" style="margin-top:-4px;">
                                            <div id="ctl00_RateArticle_RatingTable" class="small-text" data-objectref="2_1179876">

	<meta itemprop="upvoteCount" content="0">


	<div id="ctl00_RateArticle_RatingRow" class="flex-container rating-container large-stars">

					
		

		
		<div class="nowrap tooltip">

			
			<div id="ctl00_RateArticle_ResultNoHist" class="rating-result"><div class="flex-container rating-stars large-stars"><div style="width:24px;position:relative" class="clipped"><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px;position:absolute;top:0px;right:0"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div><div><img src="./Resources/star-empty-lg.png" style="width:24px;height:24px"></div></div></div>
			

			
			

			
            

			
                

		</div>
		
	
		
		<div id="ctl00_RateArticle_VoteCountNoHist" class="rating-votes nowrap">0.00/5  (No votes)</div>	

		

		
		<div class="rating-undo" title="Undo vote" style="margin-left:5px;display:none"></div>

		
		
	</div>

	
	

</div>

                                        </div>
                                    </div>

                                    <div class="flex-container" style="color:#666;font-size:smaller">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">1 Apr 2017, last revision: 20 Feb 2021</span><span id="ctl00_HorizontalStats" class="stats flex-item-tight"><span class="stats"><span title="Views"><img src="./Resources/views32.png" style="width:16px"> 1</span> &nbsp; </span></span>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_DescriptionSpot" class="summary">Similar to ASCII Art, Unicode Art offers better tonal range, impressive look, and some fun on this sunny April day</div><span id="ctl00_ThumbnailUrl" class="date" content="https://www.codeproject.com/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					

					
					

						
					

					

						
						<div id="contentdiv" class="text">
						



<!-- Article Starts -->

<ul class="download">
	<li><a href="Unicode-Art.zip">Download source code and sample images — 291.8 KB</a></li></ul>

<p id="top-image"><img alt="2017-04-01.Unicode-Art.title.webp" src="./Resources-articles/2017-04-01.Unicode-Art.title.webp"/></p>

<blockquote class="FQ" id="epigraph">
<div class="FQA">Epigraph:</div>

<p><i>I would rather be <a href="https://msdn.microsoft.com/en-us/library/ms743737%28v=vs.110%29.aspx">adorned</a> by beauty of <a href="http://unicode.org/glossary/#character">character</a> than jewels</i></p>

<dl>
	<dd><a href="https://en.wikipedia.org/wiki/Plautus">Plautus</a></dd></dl>
</blockquote>

<h2>Contents</h2>

<div id="TOC">
<ul style="list-style-type: none; list-style-image: initial">
	<li><a href="#introduction">Introduction</a></li>	<li><a href="#operation">Operation</a></li>	<li><a href="#research">Research</a></li>	<li><a href="#performance">Performance</a></li>	<li><a href="#threading">Threading</a></li>	<li><a href="#html-rendering">HTML Rendering</a></li>	<li><a href="#new-style-elements">New Style Elements</a></li>	<li><a href="#application-and-window-icons">Application and Window Icons</a></li>	<li><a href="#compatibility-and-build">Compatibility and Build</a></li>	<li><a href="#instead-of-conclusions-aleph-numbers">Instead of Conclusions: Aleph Numbers</a></li>	<li><a href="#licensing-notes">Licensing Notes</a></li></ul>
</div>

<h2 id="introduction">Introduction</h2>

<p>On this nice <a href="https://en.wikipedia.org/wiki/April_Fools&#39;_Day">spring day</a>, it’s a great time to have some fun.</p>

<p>Compared to <a href="https://en.wikipedia.org/wiki/ASCII_art">ASCII art</a>, its Unicode analog is easier for the automatic generation; at the same time, the result can look more <a href="#conversion">impressive</a>, due to better tonal set of the <a href="#epigraph">characters</a> — there are so many of them in Unicode!</p>

<p>Human visual perception is an amazingly complicated thing. It presents a lot of subtle problems of the visual presentation of everything. On the other hand, the power of human perception is dramatically underestimated. Accordingly, the preparation of the photographs or other images for the conversion into a good-looking Unicode Art form takes some artistry.</p>

<p>At the same time, the application offered in the present article helps to get some basic experience pretty quickly, because, with almost every small reasonably contrast and clear photograph on input, it produces quite a recognizable rendition of the character-composed image. Let’s see how it is done.</p>

<h2 id="operation">Operation</h2>

<p>The operation of the application is quite simple. The user selects an input image file and the font used for rendering the output image. “Preview” renders the image in a separate window, which can later be saved in one of three forms: as an image file, plain text file, or HTML.</p>

<p>The preview can be switched between two modes: in a <code>Viewbox</code> showing the entire image scaled to fit the window size, or “original pixel size” viewed in a <code>ScrollViewer</code>. With “original pixel size”, if the font size used is, for example, 12 pixels, each character is presented pixel to pixel, taking exactly 12x12 pixels on a screen.</p>

<p>The input image should be prepared with some care. If the image size combined with the font size is too big, the rendering process may take too much time. However, it can be aborted separately per each preview window. The preparation of the input image for a really nice rendition will need some practice. Font parameters make the difference, but the tonal range of the image and its clarity are even more critical. From the first attempts, it’s not so easy to predict how the results will look.</p>

<p>That’s why some conversions can produce somewhat surprising results:</p>

<p id="conversion"><img alt="2017-04-01.Unicode-Art.convert.webp" src="./Resources-articles/2017-04-01.Unicode-Art.convert.webp"/></p>

<p>To preserve the original <em>aspect ratio</em>, the characters representing pixels are always rendered in a square area with the square side equal to the font size. As a result of this design, the font does not have to be <em>monospace</em>: in all cases, a character <a href="https://en.wikipedia.org/wiki/Glyph">glyph</a>, if its measures are different, is placed in the center of this square. That can reduce the apparent character densities, but the output images can still be good.</p>

<h2 id="research">Research</h2>

<p>It took some effort to study how different font families, metrics, and <a href="http://unicode.org/glossary/#character_repertoire">character <em>repertoires</em></a> can render the dynamic range of some images.</p>

<p>To map a subset of <a href="#epigraph">characters</a> and choose characters used to represent some pixel value, we first need to collect statistics on the “brightness” of each character glyph in a certain subset of characters. Such “brightness” (quotation marks intended) can be defined as the average value of the bit in a glyph rendered in black color in a white background area of the size <code>S x S</code>, where <code>S</code> is the font size. The value calculated in this way does not correctly reflect the human perception of the “color intensity”, which is essentially <em>logarithmic</em>, but it is acceptable in the given situation; in all cases, it defines the partial ordering of the characters by brightness.</p>

<p>The target pixel format is the grayscale with 8 bits per pixel, which is more than enough, taking into account the limited tonal range of the set of characters. Even with this format, 0.. 255 tones, there are not enough pixels to cover it. So, we can map a given character set to these 256 tones, normalizing the mapping so the “darkest” character would be mapped to 0, and the blank space character — to 255. The problem is: not all values even in this 0.. 255 range would correspond to some character in the mapping. Apparently, there are too many “light” characters, with a bad deficiency in “dark” ones. The ratio of the pixel values corresponding to some character in the given set can be considered as one of the possible “quality” characteristics of the combination of the font parameters and character set.</p>

<p>This is how the mapping is calculated:</p>

<div id="mapping">
<div class="pre-lang" id="premain934648"><div>c#</div><div class="pre-action-link"><span class="copy-code" data-index="934648" id="copycode934648" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre934648" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">for</span> (<span class="code-keyword">int</span> index = <span class="code-digit">0</span>; index <span class="code-keyword">&lt;</span> brightnessValues.Length; ++index) {
    <span class="code-keyword">char</span> symbol = list[index];
    <span class="code-keyword">double</span> symbolBrightness = brightnessValues[index];
    <span class="code-keyword">double</span> dValue = (symbolBrightness - min) / (<span class="code-digit">1</span> - min) * (<span class="code-keyword">byte</span>.MaxValue);
    body[(<span class="code-keyword">int</span>)dValue].Add(symbol);
} <span class="code-comment">//</span><span class="code-comment">loop</span></pre>

<p>Here, <code>min</code> is the minimal character glyph “brightness” found, and <code>body</code> is the <code>array[0.. 255]</code> of lists of characters. After this step, the missing output pixel values (elements of the <code>body</code> array) are filled by interpolation. Please see the source file “CharacterRepertoire.cs” for more detail.</p>

<p>Amazingly, the calculation of the “brightness” of the character does not require a big font size. Indeed, the system character rendering method already does a good job mapping a small glyph using gray tones, so most of the averaging work is already done. Surprisingly, my measurements revealed that near-optimum quality (as defined above) is observed for the font size 6 to 8 pixels, for most fonts.</p>

<p>This is how the character glyph “brightness” histogram looks for one of the near-optimum situations:</p>
<img alt="2017-04-01.Unicode-Art.histogram.webp" src="./Resources-articles/2017-04-01.Unicode-Art.histogram.webp"/>
<p>(In this picture, the maximum value at the input pixel value 175 goes out of scale; the actual number of characters mapped to this pixel value is 1062. Apparently, “almost all” characters have very close glyph density values, which falls in the range of the pixel value 175 on the 0.. 255 tonal scale. This is how the fonts are designed. Font artists consider the ability to produce a uniformly looking density of text line as one of the major virtues of the art. This is one of the reasons why I’ve chosen my range of the character code points shown on the histogram: it has many “special” characters, such as block elements, box drawing, mathematical symbols, dingbats, and so on. Those are the characters of untypical glyph densities.)</p>

<p>It turned out that this calculation is fast enough, in comparison with the rendering of the input image. At first, I wanted to calculate the character repertoire mapping in advance and store it in data to be used on every run of the application, but it does not seem to be so important for the performance.</p>

<h2 id="performance">Performance</h2>

<p>Image rendering is relatively slow: the reasonably small source images take few seconds to render, but the big images I tried take hours. Remember, the size of the output file grows proportionally to the font size, squared.</p>

<p>Initially, the character repertoire is mapped to the tonal range corresponding to the pixel values 0.. 255. This calculation is done only once in the lifetime of the application and then reused. Strictly speaking, the calculation should be performed separately for each font, because, potentially, it may affect the ordering of the characters by “brightness”, but I did not notice any considerable difference. On my system, this part of calculations adds a couple of seconds on the first run. Any reasonable-size input file rendering takes more time.</p>

<p>That’s why it’s important to use threading.</p>

<h2 id="threading">Threading</h2>

<p>First of all, the output image is rendered as a <code>System.Windows.Media.Imaging.BitmapSource</code>. The <em>runtime type</em> used as a source for showing the image in the preview is <code>System.Windows.Media.Imaging.RenderTargetBitmap</code>. Even though the rendering requires the use of <code>System.Windows.Media.DrawingContext</code>, the use of direct rendering has prohibitively poor performance of the preview, in this particular situation, for pretty obvious reasons.</p>

<p>That’s why <code>RenderTargetBitmap</code> is used. First of all, it is needed to produce the image file when the user wants to save it. At the same time, the instance of this type is used permanently (per the “Preview” window) for the display of the rendered image, as the <code>Image.Source</code>.</p>

<p>Each Preview window uses a separate thread. This is not a very typical situation where the number of the process threads is unlimited, but it reasonable for this application. It’s important that the user can choose to render another image while waiting for the rendering threads started before, with the possibility of aborting them if it takes too long.</p>

<p>The implementation is fundamentally based on the concept of <em>thread wrapper</em> which I started to explain in my articles <a href="https://www.codeproject.com/Articles/406123/Many-Questions-Answered-At-Once-Graphics-WinForms">Many Questions Answered At Once: Interactive Animated Graphics with Forms</a>, <a href="https://www.codeproject.com/Articles/1177478/Thread-Wrapper-CPP"> Thread Wrapper for Modern C++</a>, and <a href="https://www.codeproject.com/Articles/1177869/Conveyor-Thread-Wrapper-CPP"> Conveyor Thread Wrapper for Modern C++</a>. This is a kind of <em>ad hoc</em> wrapper for the present application:</p>

<div id="threadWrapper">
<div class="pre-lang" id="premain963874"><div>c#</div><div class="pre-action-link"><span class="code-collapse" data-index="963874" id="preShrink963874">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="963874" id="copycode963874" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre963874" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">class</span> ThreadWrapper {

    <span class="code-keyword">internal</span> ThreadWrapper(
        PreviewWindow presentation,
        Image image,
        Main.Renderer renderer, BitmapImage source,
        Typeface typeface, <span class="code-keyword">int</span> fontSize,
        Dispatcher dispatcher) {
            <span class="code-keyword">this</span>.presentation = presentation;
            <span class="code-keyword">this</span>.image = image;
            <span class="code-keyword">this</span>.typeface = typeface;
            <span class="code-keyword">this</span>.fontSize = fontSize;
            <span class="code-keyword">this</span>.renderer = renderer;
            <span class="code-keyword">this</span>.source = source;
            source.Freeze();
            <span class="code-keyword">this</span>.dispatcher = dispatcher;
    } <span class="code-comment">//</span><span class="code-comment">ThreadWrapper</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">void</span> Start() {
        thread = <span class="code-keyword">new</span> Thread(Body);
        thread.TrySetApartmentState(ApartmentState.STA);
        thread.Start();
    } <span class="code-comment">//</span><span class="code-comment">Start</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">void</span> Abort() {
        thread.Abort();
    } <span class="code-comment">//</span><span class="code-comment">Abort</span>

    <span class="code-keyword">internal</span> <span class="code-keyword">void</span> Join() {
        thread.Join();
    } <span class="code-comment">//</span><span class="code-comment">Join</span>

    <span class="code-keyword">void</span> Body() {
        <span class="code-keyword">try</span> {
            ImageSource imageSource = renderer.Render(source, typeface, fontSize, <span class="code-digit">0</span>);
            dispatcher.Invoke(<span class="code-keyword">new</span> System.Action(() =<span class="code-keyword">&gt;</span> {
                image.Source = imageSource;
                image.Width = source.Width * fontSize;
                image.Height = source.Height * fontSize;
                presentation.menu.Visibility = Visibility.Visible;
                presentation.SetTarget(RenderTarget.scaled);
            }));
        } <span class="code-keyword">catch</span> (ThreadAbortException) {
        } <span class="code-keyword">catch</span> (System.Exception e) {
            dispatcher.Invoke(
                <span class="code-keyword">new</span> System.Action&lt;Exception&gt;((Exception exception) =<span class="code-keyword">&gt;</span> {
                    presentation.ShowException(exception);
                }), e);
        } <span class="code-comment">//</span><span class="code-comment">exception</span>
    } <span class="code-comment">//</span><span class="code-comment">Body</span>

    Thread thread;
    Dispatcher dispatcher;
    Main.Renderer renderer;
    BitmapImage source;
    PreviewWindow presentation;
    Image image;
    Typeface typeface;
    <span class="code-keyword">int</span> fontSize;

} <span class="code-comment">//</span><span class="code-comment">class ThreadWrapper</span></pre>

<p>Note that the thread can be asynchronously aborted, which sometimes faces fierce opposition from other developers. It is too big and a complicated topic to cover here, so I’ll confine the discussion with just the claim: I do it in a safe way specific to each application.</p>

<p>One important point about threading is thread synchronization. In the present application, there are two points where we need to pass data between the two threads, the UI thread and a thread rendering each preview instance. First, the input image reference is passed to the image-rendering thread. At the end, the rendered <code>ImageSource</code> is passed to the UI thread for the presentation, as a property <code>Image.Source</code>. These two transitions are fundamentally based on the method <code>Freeze</code>: <a href="https://msdn.microsoft.com/en-us/library/ms557735%28v=vs.110%29.aspx">see <code>System.Windows.Freezable.Freeze</code></a>.</p>

<h2 id="html-rendering">HTML Rendering</h2>

<p>At first glance, it would be likely to expect that text and HTML presentation of the Unicode art would be easy to achieve. However, I managed to screw up the first attempt. Here are the missing points:</p>

<ol>
	<li>Some characters included in the character repertoire might be not supported by a particular font. In bitmap rendering, it won’t create a big problem, because all characters are rendered in the same fixed area on the output bitmap. In HTML such characters may still be rendered and take some space, but even with monospace fonts the horizontal space, the width can be different, which causes a horizontal shift of the text lines.</li>	<li>Accidentally, some characters can act as end-of-line characters. With HTML <code>pre</code> element, it will cause the line break, possibly in the middle of a <em>stride</em>.</li>	<li>Accidentally, some sequences of characters can match HTML character entities.</li></ol>

<p>First two problems should be solved when the character repertoire is built. It’s important to filter out some characters automatically. This is the fragment of <code>CharacterRepertoire.Build</code>:</p>

<div id="character-repertoire-build">
<div class="pre-lang" id="premain511661"><div>c#</div><div class="pre-action-link"><span class="code-collapse" data-index="511661" id="preShrink511661">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="511661" id="copycode511661" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre511661" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">internal</span> <span class="code-keyword">void</span> Build(Typeface typeface) {
    GlyphTypeface glyphTypeface;
    <span class="code-keyword">bool</span> success = typeface.TryGetGlyphTypeface(<span class="code-keyword">out</span> glyphTypeface);
    <span class="code-keyword">var</span> map = glyphTypeface.CharacterToGlyphMap;            
    System.Predicate&lt;ushort&gt; isCharacterSupported = (codePoint) =<span class="code-keyword">&gt;</span> {
        <span class="code-keyword">ushort</span> glyphIndexDummy;
        <span class="code-keyword">return</span> map.TryGetValue(codePoint, <span class="code-keyword">out</span> glyphIndexDummy);
    }; <span class="code-comment">//</span><span class="code-comment">isCharacterSupported</span>
    CharacterList list = <span class="code-keyword">new</span> CharacterList();
    DoubleList brightnessList = <span class="code-keyword">new</span> DoubleList();
    <span class="code-keyword">foreach</span> (<span class="code-keyword">var</span> range <span class="code-keyword">in</span> DefinitionSet.charset)
        <span class="code-keyword">for</span> (<span class="code-keyword">ushort</span> codePoint = range.first;
            codePoint <span class="code-keyword">&lt;</span>= range.last;
            ++codePoint)
        {
            <span class="code-keyword">if</span> (!isCharacterSupported(codePoint)) <span class="code-keyword">continue</span>;
            <span class="code-keyword">char</span> character = System.Char.ConvertFromUtf32(codePoint)[<span class="code-digit">0</span>];
            <span class="code-keyword">if</span> (<span class="code-keyword">char</span>.IsSeparator(character) ||
                <span class="code-keyword">char</span>.IsControl(character))
                    <span class="code-keyword">continue</span>;
            list.Add(character);
            brightnessList.Add(GetBrightness(character, typeface));
        } <span class="code-comment">//</span><span class="code-comment">loop</span>
    <span class="code-comment">//</span><span class="code-comment"> ...</span>
}; <span class="code-comment">//</span><span class="code-comment">Build</span></pre>

<p>Besides, there are quite obvious problems, first of all, the aspect ratio. Apparently, if the font chosen family has variable-size characters, the image will be heavily deformed — even though the fall-back family is <code>monospace</code>, if some more specialized family was successfully used by the “Unicode Art” application, the same family will be found on the same system and used for the in-browser rendering. There is nothing we can do about it, but how to deal with <em>monospace</em> font families? This is another subtle aspect of HTML rendering. This is the solution:</p>

<div id="save-to-html">
<div class="pre-lang" id="premain985646"><div>c#</div><div class="pre-action-link"><span class="code-collapse" data-index="985646" id="preShrink985646">Shrink ▲</span> &nbsp; <span class="copy-code" data-index="985646" id="copycode985646" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre985646" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">internal</span> <span class="code-keyword">void</span> SaveToHtml(
        <span class="code-keyword">string</span> fileName,
        <span class="code-keyword">string</span> originalFileName,
        Typeface typeface, <span class="code-keyword">int</span> fontSize)
{
    <span class="code-keyword">if</span> (originalFileName == <span class="code-keyword">null</span>) originalFileName = <span class="code-keyword">string</span>.Empty;
    <span class="code-keyword">int</span> xMax = unicodePixels.GetUpperBound(<span class="code-digit">1</span>);
    <span class="code-keyword">int</span> yMax = unicodePixels.GetUpperBound(<span class="code-digit">0</span>);
    StringBuilder sb = <span class="code-keyword">new</span> StringBuilder();
    <span class="code-keyword">for</span> (<span class="code-keyword">var</span> indexY = <span class="code-digit">0</span>; indexY <span class="code-keyword">&lt;</span>= yMax; ++indexY) {
        <span class="code-keyword">for</span> (<span class="code-keyword">var</span> indexX = <span class="code-digit">0</span>; indexX <span class="code-keyword">&lt;</span>= xMax; ++indexX)
            sb.Append(unicodePixels[indexY, indexX]);
        <span class="code-keyword">if</span> (indexY <span class="code-keyword">&lt;</span> yMax) sb.Append(System.Environment.NewLine);
    } <span class="code-comment">//</span><span class="code-comment">loop Y</span>
    GlyphTypeface glyphTypeface;
    typeface.TryGetGlyphTypeface(<span class="code-keyword">out</span> glyphTypeface);
    System.Collections.Generic.IDictionary&lt;ushort, double&gt;
        advanceHeights = glyphTypeface.AdvanceHeights;
    System.Collections.Generic.IDictionary&lt;ushort,
        double&gt; advanceWidths = glyphTypeface.AdvanceWidths;
    <span class="code-keyword">double</span> aspect = <span class="code-digit">1</span>;
    <span class="code-keyword">double</span> width, height;
    <span class="code-keyword">ushort</span> testCharachter = DefinitionSet.fullSizeSampleCharacter;
    <span class="code-keyword">if</span> (advanceWidths.TryGetValue(testCharachter, <span class="code-keyword">out</span> width) &amp;&amp;
        advanceHeights.TryGetValue(testCharachter, <span class="code-keyword">out</span> height))
            <span class="code-comment">//</span><span class="code-comment"> then sample character is supported by typeface</span>
            aspect = width / height;
    <span class="code-keyword">string</span> html = <span class="code-keyword">string</span>.Format(
        Resources.Resources.HtmlFormat,
        originalFileName,
        <span class="code-digit">1</span>,
        aspect,
        typeface.FontFamily.ToString(),
        System.Web.HttpUtility.HtmlEncode(sb.ToString()));  
    <span class="code-keyword">using</span> (StreamWriter writer =
        <span class="code-keyword">new</span> StreamWriter(fileName, <span class="code-keyword">false</span>, Encoding.UTF8)) {
        writer.WriteLine(html);
    } <span class="code-comment">//</span><span class="code-comment">using</span>
} <span class="code-comment">//</span><span class="code-comment">SaveToHtml</span></pre>

<p>Note that the 3rd problem is solved by using <code>HtmlEncode</code>. Now, let’s look at the rendered HTML file:</p>

<div id="rendered-html">
<div class="pre-lang" id="premain742006"><div>HTML</div><div class="pre-action-link"><span class="copy-code" data-index="742006" id="copycode742006" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="HTML" lang="HTML" data-codeblock-processed="true" id="pre742006" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">&lt;</span><span class="code-leadattribute">html</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">head</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">title</span><span class="code-keyword">&gt;</span>Unicode Art<span class="code-keyword">&lt;</span><span class="code-leadattribute">/title</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">meta</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">generator"</span><span class="code-attribute"> </span><span class="code-attribute">content</span><span class="code-keyword">="</span><span class="code-keyword">UnicodeArt.exe"</span><span class="code-attribute"> </span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">meta</span><span class="code-attribute"> </span><span class="code-attribute">name</span><span class="code-keyword">="</span><span class="code-keyword">description"</span><span class="code-attribute">
    </span><span class="code-attribute">content</span><span class="code-keyword">="</span><span class="code-keyword">Generated from file: input.cow.png; ..."</span><span class="code-attribute"> </span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">meta</span><span class="code-attribute"> </span><span class="code-attribute">http-equiv</span><span class="code-keyword">="</span><span class="code-keyword">Content-Type"</span><span class="code-attribute"> </span><span class="code-attribute">content</span><span class="code-keyword">="</span><span class="code-keyword">text/html; charset=utf-8"</span><span class="code-attribute"> </span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">style</span><span class="code-attribute"> </span><span class="code-attribute">type</span><span class="code-keyword">="</span><span class="code-keyword">text/css"</span><span class="code-keyword">&gt;</span>
        <span class="code-leadattribute">pre</span> {
        <span class="code-attribute">font-size</span><span class="code-keyword">:</span><span class="code-keyword"> 1em</span>;
        <span class="code-attribute">line-height</span><span class="code-keyword">:</span><span class="code-keyword"> 0.748933577087142em</span>;
        <span class="code-attribute">font-family</span><span class="code-keyword">:</span><span class="code-keyword"> "Courier New", monospace</span>;
    }
    <span class="code-keyword">&lt;/</span><span class="code-leadattribute">style</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/head</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">body</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">&lt;</span><span class="code-leadattribute">pre</span><span class="code-keyword">&gt;</span><span class="code-keyword">&lt;!--</span><span class="code-keyword"><span class="code-comment"> image characters go here... </span><span class="code-comment">--&gt;</span></span><span class="code-keyword">&lt;</span><span class="code-leadattribute">/pre</span><span class="code-keyword">&gt;</span>

<span class="code-keyword">&lt;</span><span class="code-leadattribute">/body</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-leadattribute">/html</span><span class="code-keyword">&gt;</span></pre>

<p>This is the result of rendering:</p>

<p id="html-img"><img alt="2017-04-01.Unicode-Art.html.webp" src="./Resources-articles/2017-04-01.Unicode-Art.html.webp"/></p>

<p>(Unicode Art images rendered from identical original images may look different because different character repertoires were used.)</p>

<p>HTML browsers have some problems with such images. From the code sample <a href="#save-to-html">shown above</a>, one can see that 5 parameters are inserted in the HTML file format (see the source file “Resources/HtmlFormat.html”): original file name, the values for CSS style properties <code>font-size</code> (always 1 in <code>em</code> units), <code>line-height</code>, and <code>font-family</code>, and then the formatted stream of characters. These parameters are ultimately calculated from the font face chosen in the main window of the application.</p>

<p>But what about the aspect ratio? The answer is: it is “almost correct”. One can easily observe where the aspect ratio is a bit off by using the standard Web browser Zoom feature: zooming makes the aspect ratio flowing off, to a certain extent, depending on the zoom levels.</p>

<p>At the same time, HTML presentation is very convenient due to this zoom, as the glyphs of the image are rendered on the fly as vector graphics, so we can quickly observe separate characters or overall view.</p>

<h2 id="new-style-elements">New Style Elements</h2>

<p>A while ago, I put forward some more or less fresh style elements. We often need to defer closing of the window, which may or may not exit the whole application, most usually, to give the user the choice to save some work or cancel the changes. In WPF, it is done using the overridden method <code>System.Windows.Window.OnClosing</code> or in the handler of the event <code>System.Windows.Window.Closing</code>.</p>

<p>And who told that it should be those modal dialog boxes? Why those dialog boxes take up so much space? What is the useful function of those ugly buttons (no matter how modern they look) with all those shadows, borders, and spacing between those decorative elements? Who says that all these visual clues really help the user to understand what should be done on the request of the application? Can’t it have a much simpler look and produce less buzz? Here is how I pictured it:</p>

<p><img alt="2017-04-01.Unicode-Art.fox-closing.webp" src="./Resources-articles/2017-04-01.Unicode-Art.fox-closing.webp"/></p>

<p><img alt="2017-04-01.Unicode-Art.duck-closing.webp" src="./Resources-articles/2017-04-01.Unicode-Art.duck-closing.webp"/></p>

<p>This is just the message and menu of choices, customizable, theme-aware, visually associated with the window-closing element of the window’s non-client area (top right “=x=” icon, for current Windows style). It simply disappears (which is equivalent to “Cancel”) when it loses focus or escaped, safely leaving things as is when the user does not make a choice, which can be considered as a softer and nicer form of modality. This behavior is safe and stable in response to any accidents and requires less user input activity. All manipulations can be done with a mouse or keyboard, or any combination of both.</p>

<p>In this particular application, the choice of action is not requested for the main window if no input image is loaded. For a preview window, the choice is not requested if the user saved the image in both bitmap form and at least one of the textual forms: plain text of HTML. Therefore, the option to save a file is not shown in the closing menu, but such an option can be used in other applications.</p>

<p>The implementation of this style and behavior is tricky and interesting enough and may take a separate article.</p>

<p>The present implementation of this idea, being quite reliable, is still not fully universal or customizable, or convenient for the application developers, so it could be considered as a working prototype. For further detail, please see the source files “ClosingWindowControl.*” and “TheApplication.cs”.</p>

<h2 id="application-and-window-icons">Application and Window Icons</h2>

<p>Unfortunately, default C# project templates effectively encourage bad development practice: the <em>application icon</em> is created independently from the window icons. Even if the icon is the same, most developers don’t reuse them; and this is totally wrong because it violates the fundamental and very important in practice <a href="https://en.wikipedia.org/wiki/Single_Point_of_Truth">SPOT principle</a>. There is no obvious way of using the single source icon for both purposes.</p>

<p>In the present application, with the use of my own WPF project template, I demonstrate the known simple and reliable solution to this problem.</p>

<p>First of all, the developer needs to create an icon file, one or more. This file can be included in a .resx file and used as a resource for one or more objects, some windows, or the application (I would highly recommend the development of icons using some 3rd-party tool and included in the project as a separate file, used in a .docx file through the “Add existing file…” option.)</p>

<p>The first user of such resource should be the application. To make a reusable resource embedded in an application and an application icon, we need an explicit entry-point method (<code>Main</code>). For the environment needed to have such a method in a WPF application, please see the source file “TheApplication.cs”. This is how the entry-point method may look:</p>

<div id="entry-point">
<div class="pre-lang" id="premain432348"><div>c#</div><div class="pre-action-link"><span class="copy-code" data-index="432348" id="copycode432348" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre432348" style="margin-top: 0px;" class="notranslate">[STAThread]
<span class="code-keyword">static</span> <span class="code-keyword">void</span> Main(<span class="code-keyword">string</span>[] args) {
    <span class="code-keyword">using</span> (<span class="code-keyword">var</span> iconStream = <span class="code-keyword">new</span> System.IO.MemoryStream()) {
        TheApplication app = <span class="code-keyword">new</span> TheApplication();
        UnicodeArt.Resources.Resources.IconMain.Save(iconStream);
        iconStream.Seek(<span class="code-digit">0</span>, System.IO.SeekOrigin.Begin);
        app.ApplicationIcon =
            System.Windows.Media.Imaging.BitmapFrame.Create(iconStream);
        app.Run();
    } <span class="code-comment">//</span><span class="code-comment">using</span>
} <span class="code-comment">//</span><span class="code-comment">Main</span></pre>

<p>This code fragment assumes that the file “Resources.xres” is added to the project directory resource, and the default <em>namespace</em> is “UnicodeArt” — it produces the auto-generated name of the resource variable shown above. To obtain the name of the appropriate icon, simply find it in the auto-generated file, in this example, “Resources.Designer.cs”.</p>

<p>Assuming that at least one icon, the icon of the main window, should be the same as the application icon, I assign the application window icon when it is created in the class <code>TheApplication</code>:</p>

<div class="pre-lang" id="premain488618"><div>c#</div><div class="pre-action-link"><span class="copy-code" data-index="488618" id="copycode488618" style="visibility: visible;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 460 460" style="width: 16px;height:16px;" xml:space="preserve">
<g>
<path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272
    c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729
    c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"></path>
<path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272
    c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068
    c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001
    C291.206,428.715,289.92,430,288.341,430z"></path>	
</g>
</svg></span></div></div><pre data-lang-orig="c#" lang="c#" data-codeblock-processed="true" id="pre488618" style="margin-top: 0px;" class="notranslate"><span class="code-keyword">protected</span> <span class="code-keyword">override</span> <span class="code-keyword">void</span> OnStartup(StartupEventArgs e) {
    <span class="code-comment">//</span><span class="code-comment"> ...</span>
    MainWindow = <span class="code-keyword">new</span> Ui.MainWindow();
    MainWindow.Title = ProductName;
    MainWindow.Icon = ApplicationIcon;
    MainWindow.Show();
    <span class="code-comment">//</span><span class="code-comment"> ...</span>
} <span class="code-comment">//</span><span class="code-comment">OnStartup</span></pre>

<p>If some other windows need the same icon, they can copy the reference from the main window. Alternatively, it can be taken as <code>TheApplication.Current.ApplicationIcon</code>, assuming the <code>TheApplication.Current</code> to be the <code>TheApplication</code> <em>singleton</em> analogous to <code>Application.Current</code>, and <code>ApplicationIcon</code> is the property of this type.</p>

<h2 id="compatibility-and-build">Compatibility and Build</h2>

<p>As the code is based on WPF, I used the first platform version decently compatible with WPF — Microsoft.NET v.3.5. Correspondingly, I provided a solution and a project for Visual Studio 2008. I’ve done it intentionally, to cover all the readers who could use WPF. Later .NET versions will be supported; later versions of Visual Studio can automatically upgrade solution and project files.</p>

<p>In fact, Visual Studio is not required for the build. The code can be built as a batch, by using the provided batch file “build.bat”. If your Windows installation directory is different from the default, the build will still work. If the .NET installation directory is different from the default one, please see the content of this batch file and the comment in its first line — the next line can be modified to get the build.</p>

<h2 id="instead-of-conclusions-aleph-numbers">Instead of Conclusions: Aleph Numbers</h2>

<p>Why the <a href="#application-and-window-icons">application icon</a> is the Hebrew letter <a href="https://en.wikipedia.org/wiki/Aleph"><em>aleph</em></a>, ℵ?</p>

<p>First of all, this letter, inherited from <a href="https://en.wikipedia.org/wiki/Phoenician_alphabet">Phoenician</a> <a href="https://en.wikipedia.org/wiki/Aleph">'Ālep</a>, symbolizes the concept of the <em>alphabet</em> and the word “alphabet”, originating, through Greek ἀλφάβητος, from the first two Phoenician letters, <a href="https://en.wikipedia.org/wiki/Aleph">'Ālep</a> and <a href="https://en.wikipedia.org/wiki/Bet_%28letter%29">Bēt</a>, dating back to the <a href="https://en.wikipedia.org/wiki/Phoenicia">Phoenicians</a>, if not earlier. So, the word “alphabet” can be interpreted as “ox house” :-).</p>

<p>Also, in mathematics, this character denotes <a href="https://en.wikipedia.org/wiki/Aleph_number">aleph numbers</a> representing the <a href="https://en.wikipedia.org/wiki/Cardinality">cardinalities</a> of <a href="https://en.wikipedia.org/wiki/Infinite_set">infinite sets</a>. It suggests the idea of an “infinite” number of possible Unicode Art works, but only figuratively speaking: everything played on a computer is always some <a href="https://en.wikipedia.org/wiki/Finite_set">finite set</a>, just because any computer is merely a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite-state machine</a> :-).</p>

<p>I will gladly respond to all kinds of informative criticism and consider suggestions on the topic.</p>

<h2 id="licensing-notes">Licensing Notes</h2>

<p>In addition to <a href="http://www.codeproject.com/info/cpol10.aspx">The Code Project Open License</a>:</p>

<p>All the images are original, created from scratch by <a href="http://www.codeproject.com/Members/SAKryukov">the author of the article</a>.</p>

<p>At the same time, the character <em>glyphs</em> used in some of the images can be copyrighted by the developers of the fonts used. Eventually, royalty payment can be requested by the owners of the proprietary copyrighted fonts from any user of the present application, as well as from any authors of any textual rendered work (printed or printable books, articles, application UI, finance reports, and the like). :-)</p>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Article Ends -->


						</div>
						

						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article has no explicit license attached to it but may contain usage terms in the article text or the download files themselves. If in doubt please contact the author via the discussion board below.</p><p>A list of licenses authors might use can be found <a href="https://www.codeproject.com/info/Licenses.aspx">here</a></p></div>
						

						
						<br>
						
						    <br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    
				</div>
				
                
                

				
				
				

			</div>
			

            
            
            

        </div>
        

		
		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/1179876/Unicode-Art">Permalink</a><br>
				<br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/1179876/Unicode-Art?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/1179876/Unicode-Art?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2017 by Sergey Alexandrovich Kryukov<br>Everything else
				Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2024<br>
                <br>
				Web01 
				2.8:2024-12-08:1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>







<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	new CodeBlocks().initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');

})
</script>










<style type="text/css">.copied::after {  position: absolute;  right: 0;  display: inline-block; white-space: nowrap; content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 8px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; } 70% { opacity: 1; } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>